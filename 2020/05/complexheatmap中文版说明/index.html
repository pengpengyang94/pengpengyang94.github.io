<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.68.3 with theme Tranquilpeak 0.4.7-BETA">
<meta name="author" content="Ezio">
<meta name="keywords" content="">
<meta name="description" content="　　本文主要是对 ComplexHeatmap Complete Reference（last revised on 2020-04-29）内容的翻译及理解，并且根据理解修改了部分示例以缩短原文的内容，主要是为了记录学习 ComplexHeatmap 包的过程，方便日后翻阅。">


<meta property="og:description" content="　　本文主要是对 ComplexHeatmap Complete Reference（last revised on 2020-04-29）内容的翻译及理解，并且根据理解修改了部分示例以缩短原文的内容，主要是为了记录学习 ComplexHeatmap 包的过程，方便日后翻阅。">
<meta property="og:type" content="article">
<meta property="og:title" content="ComplexHeatmap中文版说明">
<meta name="twitter:title" content="ComplexHeatmap中文版说明">
<meta property="og:url" content="https://pengpengyang94.github.io/2020/05/complexheatmap%E4%B8%AD%E6%96%87%E7%89%88%E8%AF%B4%E6%98%8E/">
<meta property="twitter:url" content="https://pengpengyang94.github.io/2020/05/complexheatmap%E4%B8%AD%E6%96%87%E7%89%88%E8%AF%B4%E6%98%8E/">
<meta property="og:site_name" content="一个慵懒之人的随笔">
<meta property="og:description" content="　　本文主要是对 ComplexHeatmap Complete Reference（last revised on 2020-04-29）内容的翻译及理解，并且根据理解修改了部分示例以缩短原文的内容，主要是为了记录学习 ComplexHeatmap 包的过程，方便日后翻阅。">
<meta name="twitter:description" content="　　本文主要是对 ComplexHeatmap Complete Reference（last revised on 2020-04-29）内容的翻译及理解，并且根据理解修改了部分示例以缩短原文的内容，主要是为了记录学习 ComplexHeatmap 包的过程，方便日后翻阅。">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2020-05-13T12:38:37">
  
  
    <meta property="article:modified_time" content="2020-05-13T12:38:37">
  
  
  
    
      <meta property="article:section" content="R语言作图">
    
  
  
    
      <meta property="article:tag" content="ComplexHeatmap">
    
      <meta property="article:tag" content="Heatmap">
    
  


<meta name="twitter:card" content="summary">







  <meta property="og:image" content="//i.loli.net/2020/05/13/KJWiacwXbolZgtY.png">
  <meta property="twitter:image" content="//i.loli.net/2020/05/13/KJWiacwXbolZgtY.png">


  <meta property="og:image" content="//i.loli.net/2020/05/13/d1YvLQmoSC4BNW9.png">
  <meta property="twitter:image" content="//i.loli.net/2020/05/13/d1YvLQmoSC4BNW9.png">




  <meta property="og:image" content="https://i.loli.net/2020/04/15/xFaPfkeSHjc3sg4.jpg">
  <meta property="twitter:image" content="https://i.loli.net/2020/04/15/xFaPfkeSHjc3sg4.jpg">


    <title>ComplexHeatmap中文版说明</title>

    <link rel="icon" href="https://pengpengyang94.github.io/favicon.png">
    

    

    <link rel="canonical" href="https://pengpengyang94.github.io/2020/05/complexheatmap%E4%B8%AD%E6%96%87%E7%89%88%E8%AF%B4%E6%98%8E/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://pengpengyang94.github.io/css/style-twzjdbqhmnnacqs0pwwdzcdbt8yhv8giawvjqjmyfoqnvazl0dalmnhdkvp7.min.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="5">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://pengpengyang94.github.io/">一个慵懒之人的随笔</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://pengpengyang94.github.io/#about">
    
    
    
      
        <img class="header-picture" src="https://i.loli.net/2020/04/15/xFaPfkeSHjc3sg4.jpg" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="5">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://pengpengyang94.github.io/#about">
          <img class="sidebar-profile-picture" src="https://i.loli.net/2020/04/15/xFaPfkeSHjc3sg4.jpg" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Ezio</h4>
        
          <h5 class="sidebar-profile-bio">学习、记录、变强，最后 <strong>变秃</strong></h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://pengpengyang94.github.io/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://pengpengyang94.github.io/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-folder-open"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://pengpengyang94.github.io/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://pengpengyang94.github.io/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://pengpengyang94.github.io/#about">
    
      <i class="sidebar-button-icon fa fa-lg fa-user-o"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/pengpengyang94" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://space.bilibili.com/87148526" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-caret-square-o-right"></i>
      
      <span class="sidebar-button-desc">Bilibili</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.bioinfo.info/?/people/Ezio" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-twitch"></i>
      
      <span class="sidebar-button-desc">Bioinfo</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://pengpengyang94.github.io/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      
  <div class="post-header-cover
              text-center
              "
       style="background-image:url('//i.loli.net/2020/05/13/d1YvLQmoSC4BNW9.png')"
       data-behavior="5">
    
  </div>


      <div id="main" data-behavior="5"
        class="hasCover
               hasCoverMetaOut
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-center">
  
    <h1 class="post-title" itemprop="headline">
      ComplexHeatmap中文版说明
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2020-05-13T12:38:37&#43;08:00">
        
  May 13, 2020

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="https://pengpengyang94.github.io/categories/r%e8%af%ad%e8%a8%80%e4%bd%9c%e5%9b%be">R语言作图</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p>　　本文主要是对 <strong><a href="https://jokergoo.github.io/ComplexHeatmap-reference/book/">ComplexHeatmap Complete Reference</a></strong>（last revised on 2020-04-29）内容的翻译及理解，并且根据理解修改了部分示例以缩短原文的内容，主要是为了记录学习 <strong>ComplexHeatmap</strong> 包的过程，方便日后翻阅。</p>
<p><strong>ComplexHeatmap</strong> 不仅可以画单个的热图，也可以制作多个热图及注释信息相互组合起来的更为复杂的图形，所以有必要先了解作者的构图思路。<br>
　　下图是作者的构图布局图，中间红色部分是画热图的部分，单个或者多个热图都可以，四个边都有可以添加如下图四种信息的部分。</p>
<p><img src="https://i.loli.net/2020/05/12/9hW7tExJPrXiBul.png" alt="ComplexHeatmap-0.png"></p>
<p>　　按照原文章节安排，本文主要分为下面八个板块，其中略有删减，如若不懂可以翻看原文。<br>
　　<strong>ComplexHeatmap</strong> 安装代码如下，随便选择一种即可：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;ComplexHeatmap&#34;</span>)
devtools<span style="color:#f92672">::</span><span style="color:#a6e22e">install_github</span>(<span style="color:#e6db74">&#34;jokergoo/ComplexHeatmap&#34;</span>)
</code></pre></div><h2 id="1-a-single-heatmap">1 A Single Heatmap</h2>
<p>　　本节主要介绍如何绘制单个热图，这也是绘制热图中需求最大的一部分，理解这部分就可以实现其他画热图R包（如 <strong>pheatmap</strong> 包）的绝大部分功能。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># 加载R包</span>
<span style="color:#a6e22e">rm</span>(list <span style="color:#f92672">=</span> <span style="color:#a6e22e">ls</span>())
<span style="color:#a6e22e">library</span>(ComplexHeatmap)

<span style="color:#75715e"># 准备数据</span>
<span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">123</span>)
nr1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>; nr2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>; nr3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>; nr <span style="color:#f92672">=</span> nr1 <span style="color:#f92672">+</span> nr2 <span style="color:#f92672">+</span> nr3
nc1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>; nc2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>; nc3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>; nc <span style="color:#f92672">=</span> nc1 <span style="color:#f92672">+</span> nc2 <span style="color:#f92672">+</span> nc3
mat <span style="color:#f92672">=</span> <span style="color:#a6e22e">cbind</span>(<span style="color:#a6e22e">rbind</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(nr1<span style="color:#f92672">*</span>nc1, mean <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>,   sd <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>), nr <span style="color:#f92672">=</span> nr1),
                  <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(nr2<span style="color:#f92672">*</span>nc1, mean <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,   sd <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>), nr <span style="color:#f92672">=</span> nr2),
                  <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(nr3<span style="color:#f92672">*</span>nc1, mean <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,   sd <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>), nr <span style="color:#f92672">=</span> nr3)),
            <span style="color:#a6e22e">rbind</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(nr1<span style="color:#f92672">*</span>nc2, mean <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,   sd <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>), nr <span style="color:#f92672">=</span> nr1),
                  <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(nr2<span style="color:#f92672">*</span>nc2, mean <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>,   sd <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>), nr <span style="color:#f92672">=</span> nr2),
                  <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(nr3<span style="color:#f92672">*</span>nc2, mean <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,   sd <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>), nr <span style="color:#f92672">=</span> nr3)),
            <span style="color:#a6e22e">rbind</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(nr1<span style="color:#f92672">*</span>nc3, mean <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>, sd <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>), nr <span style="color:#f92672">=</span> nr1),
                  <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(nr2<span style="color:#f92672">*</span>nc3, mean <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>, sd <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>), nr <span style="color:#f92672">=</span> nr2),
                  <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(nr3<span style="color:#f92672">*</span>nc3, mean <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>,   sd <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>), nr <span style="color:#f92672">=</span> nr3))
            )
mat <span style="color:#f92672">=</span> mat<span style="color:#a6e22e">[sample</span>(nr, nr), <span style="color:#a6e22e">sample</span>(nc, nc)] <span style="color:#75715e"># 随机打乱行和列</span>
<span style="color:#a6e22e">rownames</span>(mat) <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;row&#34;</span>, <span style="color:#a6e22e">seq_len</span>(nr))
<span style="color:#a6e22e">colnames</span>(mat) <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;column&#34;</span>, <span style="color:#a6e22e">seq_len</span>(nc))
</code></pre></div><p>使用默认参数的代码及绘图结果如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(mat)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/vi1T9OneByrC2SP.png" alt="ComplexHeatmap-1.1.png"></p>
<p>这里插播一个<strong>批量出图</strong>的小技巧，可以在循环里面使用如下代码：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ht <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat)
<span style="color:#a6e22e">draw</span>(ht)
</code></pre></div><h3 id="11-colors">1.1 Colors</h3>
<p>图的好看与否，<strong>配色</strong>占了相当一部分的比重。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">col_fun <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-2</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>))
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, col <span style="color:#f92672">=</span> col_fun)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/JIryEXhYmBnCHLQ.png" alt="ComplexHeatmap-1.2.png"></p>
<p>　　上面代码利用 <code>col</code> 参数将默认的<strong>蓝</strong>白红变成了<strong>绿</strong>白红，其中颜色映射的数值范围是正负 2 之间，<strong>超过此范围的值的颜色都将使用阈值所对应的颜色</strong>。下面代码将会验证这个说法，善于利用这种设置阈值颜色的手段，可以提高热图的对比度。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">mat2 <span style="color:#f92672">=</span> mat
mat2[1, <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">100000</span> <span style="color:#75715e"># 设置极端值</span>
<span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, col <span style="color:#f92672">=</span> col_fun)
<span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, col <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-20</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">20</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>)))
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/23i8G7PoBKsZz4w.png" alt="ComplexHeatmap-1.3.png"></p>
<p>　　上图仅消除了极端值对颜色的影响，并没有消除极端值对聚类的影响，这个问题在聚类的小节会有相关说明。<br>
　　除了上述利用 <code>circlize::colorRamp2</code> 来设置阈值所映射的颜色之外，也可以直接填入颜色向量集来改变颜色。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, col <span style="color:#f92672">=</span> <span style="color:#a6e22e">rev</span>(<span style="color:#a6e22e">rainbow</span>(<span style="color:#ae81ff">10</span>)))
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, col <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#39;#7b3294&#39;</span>,<span style="color:#e6db74">&#39;#c2a5cf&#39;</span>,<span style="color:#e6db74">&#39;#f7f7f7&#39;</span>,<span style="color:#e6db74">&#39;#a6dba0&#39;</span>,<span style="color:#e6db74">&#39;#008837&#39;</span>))
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/6L3t8FYj45PRpDk.png" alt="ComplexHeatmap-1.4.png"></p>
<p>　　值得一提的是 <strong>ComplexHeatmap</strong> 支持矩阵中包含 <strong>NA 值</strong>，并且可以使用 <code>na_col</code> 来控制其颜色，下面代码将 <strong>NA 值</strong>的颜色设置为黑色。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">mat_with_na <span style="color:#f92672">=</span> mat
na_index <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#a6e22e">c</span>(<span style="color:#66d9ef">TRUE</span>, <span style="color:#66d9ef">FALSE</span>), <span style="color:#a6e22e">nrow</span>(mat)<span style="color:#f92672">*</span><span style="color:#a6e22e">ncol</span>(mat), replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, prob <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">9</span>))
mat_with_na[na_index] <span style="color:#f92672">=</span> <span style="color:#66d9ef">NA</span>
<span style="color:#a6e22e">Heatmap</span>(mat_with_na, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, na_col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/Bd7pjVCxzeQnk4i.png" alt="ComplexHeatmap-1.5.png"></p>
<p>热图主体的边框及热图中每个格子的边框都是可以进行调整的。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># 热图主体的边框</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, border <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)

<span style="color:#75715e"># 热图每个格子的边框 border</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, rect_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>))
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/aNIDq4ieElvm5Sf.png" alt="ComplexHeatmap-1.6.png"></p>
<p>　　最后比较一下不同色系之间的差异，有需求的用户可以在下面代码的基础上自己探索适合自己的色系，提供的色系有 <strong>RGB</strong>, <strong>HSV</strong>, <strong>HLS</strong>, <strong>LAB</strong>, <strong>XYZ</strong>, <strong>sRGB</strong> 和 <strong>LUV</strong>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">f1 <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">seq</span>(<span style="color:#a6e22e">min</span>(mat), <span style="color:#a6e22e">max</span>(mat), length <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;blue&#34;</span>, <span style="color:#e6db74">&#34;#EEEEEE&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>))
f2 <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">seq</span>(<span style="color:#a6e22e">min</span>(mat), <span style="color:#a6e22e">max</span>(mat), length <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;blue&#34;</span>, <span style="color:#e6db74">&#34;#EEEEEE&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>), 
                space <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;RGB&#34;</span>)
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, col <span style="color:#f92672">=</span> f1, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;LAB color space&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#75715e"># 默认</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, col <span style="color:#f92672">=</span> f2, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;RGB color space&#34;</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/Hx1ZyfEOpJPMv5d.png" alt="ComplexHeatmap-1.7.png"></p>
<h3 id="12-titles">1.2 Titles</h3>
<p>　　与标题相关的参数都是带有 <code>title</code> 的，主要有行标题和列标题，比较实用参数代码展示如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, 
        column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;I am a column title&#34;</span>, <span style="color:#75715e"># 列标题</span>
        row_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;I am a row title&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#75715e"># 行标题</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;I am a column title at the bottom&#34;</span>, 
        column_title_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#75715e"># 标题位置（&#34;left&#34;, &#34;right&#34;,&#34;top&#34;, &#34;bottom&#34;）</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;column title&#34;</span>, column_title_rot <span style="color:#f92672">=</span> <span style="color:#ae81ff">90</span>) <span style="color:#75715e"># 旋转角度（0, 90, 270）</span>
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/uhzglnM32eJyQjA.png" alt="ComplexHeatmap-1.8.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;I am a big column title&#34;</span>, 
        column_title_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>, <span style="color:#75715e"># 标题大小</span>
                               fontface <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bold&#34;</span>)) <span style="color:#f92672">+</span> <span style="color:#75715e"># 标题字体</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;I am a column title&#34;</span>, 
        column_title_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#75715e"># 标题背景色</span>
                               col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#75715e"># 标题颜色</span>
                               border <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>)) <span style="color:#75715e"># 标题边框色</span>
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/QjZndwouDhqTe3E.png" alt="ComplexHeatmap-1.9.png"></p>
<p>还可以设置分割后的热图的各组标题。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, row_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cluster_%s&#34;</span>, 
        row_title_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>,fontface <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bold&#34;</span>))
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/2jdHrVoXgZwUkiL.png" alt="ComplexHeatmap-1.10.png"></p>
<h3 id="13-clustering">1.3 Clustering</h3>
<p>　　<strong>Clustering</strong> 分为两步首先需要<strong>计算距离</strong>，再进行<strong>聚类</strong>。这两步在 <strong>ComplexHeatmap</strong> 中提供有内置的方法，用户也可以传入<strong>自定义</strong>方法。</p>
<p>下面代码主要是一些图形控制方面的参数：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, cluster_rows <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#75715e"># 关闭行聚类</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, show_column_dend <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#75715e"># 隐藏列树图</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat3&#34;</span>, 
        row_dend_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;right&#34;</span>, <span style="color:#75715e"># 行树图位置</span>
        column_dend_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>) <span style="color:#75715e"># 列树图位置</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat4&#34;</span>, 
        column_dend_height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), <span style="color:#75715e"># 列树图高度 </span>
        row_dend_width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)) <span style="color:#75715e"># 行树图宽度</span>
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/tDs3u1OYN9cjLRZ.png" alt="ComplexHeatmap-1.11.png"></p>
<h4 id="131-distance-methods">1.3.1 Distance methods</h4>
<p>　　使用 <code>clustering_distance_rows/clustering_distance_column</code> 来选择不同的距离计算方法或者传入自定义的方法，内置的计算距离方法有 <strong>euclidean</strong>, <strong>maximum</strong>, <strong>manhattan</strong>, <strong>canberra</strong>, <strong>binary</strong>, <strong>minkowski</strong>, <strong>pearson</strong>, <strong>spearman</strong> 和 <strong>kendall</strong>，并且是允许出现** NA 值**的。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, clustering_distance_rows <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;pearson&#34;</span>,
        column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;pre-defined distance method (1 - pearson)&#34;</span>)

<span style="color:#75715e"># 可以自定义计算矩阵的距离,函数应该只包含一个参数</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, clustering_distance_rows <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(m) <span style="color:#a6e22e">dist</span>(m),
        column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;a function that calculates distance matrix&#34;</span>)

<span style="color:#75715e"># 可以自定义计算向量的距离,函数应该包含两个参数（速度会减慢）</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, clustering_distance_rows <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(x, y) <span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">cor</span>(x, y),
        column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;a function that calculates pairwise distance&#34;</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/cAQIuO4EYJloqKZ.png" alt="ComplexHeatmap-1.12.png"></p>
<p>　　下面就来展示一下自定义的一些骚操作。前面看到了极端值对聚类的影响，我们可以在<strong>计算距离的时候去除这个影响</strong>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># 构建含有极端值的矩阵</span>
mat_with_outliers <span style="color:#f92672">=</span> mat
<span style="color:#a6e22e">for</span>(i in  <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>) mat_with_outliers[i, i] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>

<span style="color:#75715e"># 自定义的距离计算方法</span>
robust_dist <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(x, y) {
  qx <span style="color:#f92672">=</span> <span style="color:#a6e22e">quantile</span>(x, <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">0.9</span>))
  qy <span style="color:#f92672">=</span> <span style="color:#a6e22e">quantile</span>(y, <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">0.9</span>))
  l <span style="color:#f92672">=</span> x <span style="color:#f92672">&gt;</span> qx[1] <span style="color:#f92672">&amp;</span> x <span style="color:#f92672">&lt;</span> qx[2] <span style="color:#f92672">&amp;</span> y <span style="color:#f92672">&gt;</span> qy[1] <span style="color:#f92672">&amp;</span> y <span style="color:#f92672">&lt;</span> qy[2]
  x <span style="color:#f92672">=</span> x[l]
  y <span style="color:#f92672">=</span> y[l]
  <span style="color:#a6e22e">sqrt</span>(<span style="color:#a6e22e">sum</span>((x <span style="color:#f92672">-</span> y)^2))
}

<span style="color:#75715e"># 利用 clustering_distance_* 传入自定义的距离计算方法 </span>
<span style="color:#a6e22e">Heatmap</span>(mat_with_outliers, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, 
        col <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-2</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>)),
        clustering_distance_rows <span style="color:#f92672">=</span> robust_dist,
        clustering_distance_columns <span style="color:#f92672">=</span> robust_dist,
        column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;robust_dist&#34;</span>)

<span style="color:#75715e"># 使用默认方法</span>
<span style="color:#a6e22e">Heatmap</span>(mat_with_outliers, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, 
        col <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-2</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>)),
        column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dist&#34;</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/zsCwkYJtBe4WcZS.png" alt="ComplexHeatmap-1.13.png"></p>
<p>提供合适的方法，字符串同样也可以聚类。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">mat_letters <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>], <span style="color:#ae81ff">100</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>), <span style="color:#ae81ff">10</span>)

<span style="color:#75715e"># distance in the ASCII table</span>
dist_letters <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(x, y) {
  x <span style="color:#f92672">=</span> <span style="color:#a6e22e">strtoi</span>(<span style="color:#a6e22e">charToRaw</span>(<span style="color:#a6e22e">paste</span>(x, collapse <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>)), base <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>)
  y <span style="color:#f92672">=</span> <span style="color:#a6e22e">strtoi</span>(<span style="color:#a6e22e">charToRaw</span>(<span style="color:#a6e22e">paste</span>(y, collapse <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>)), base <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>)
  <span style="color:#a6e22e">sqrt</span>(<span style="color:#a6e22e">sum</span>((x <span style="color:#f92672">-</span> y)^2))
}

<span style="color:#a6e22e">Heatmap</span>(mat_letters, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;letters&#34;</span>, col <span style="color:#f92672">=</span> <span style="color:#a6e22e">structure</span>(<span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span>, names <span style="color:#f92672">=</span> <span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>]),
        clustering_distance_rows <span style="color:#f92672">=</span> dist_letters, clustering_distance_columns <span style="color:#f92672">=</span> dist_letters,
        cell_fun <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(j, i, x, y, w, h, col) { <span style="color:#75715e"># add text to each grid</span>
          <span style="color:#a6e22e">grid.text</span>(mat_letters[i, j], x, y)
        })
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/ZwVO6lRcYSgm8pB.png" alt="ComplexHeatmap-1.14.png"></p>
<h4 id="132-clustering-methods">1.3.2 Clustering methods</h4>
<p>　　使用 <code>clustering_method_rows/clustering_method_column</code> 来选择不同的聚类方法或者传入自定义的方法，内置的计算距离方法有 <strong>ward.D</strong>, <strong>ward.D2</strong>, <strong>single</strong>, <strong>complete</strong> 等。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, clustering_method_rows <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;single&#34;</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/HGzmxTyhBE4AuPS.png" alt="ComplexHeatmap-1.15.png"></p>
<p>下面展示了三种自定义方法传入的方式，效果是一样的：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">library</span>(cluster)
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, 
        cluster_rows <span style="color:#f92672">=</span> <span style="color:#a6e22e">diana</span>(mat),
        cluster_columns <span style="color:#f92672">=</span> <span style="color:#a6e22e">agnes</span>(<span style="color:#a6e22e">t</span>(mat)), 
        column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;clustering objects&#34;</span>)

<span style="color:#75715e"># if cluster_columns is set as a function, you don&#39;t need to transpose the matrix</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, 
        cluster_rows <span style="color:#f92672">=</span> diana,
        cluster_columns <span style="color:#f92672">=</span> agnes, 
        column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;clustering functions&#34;</span>)

<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, 
        cluster_rows <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(m) <span style="color:#a6e22e">as.dendrogram</span>(<span style="color:#a6e22e">diana</span>(m)),
        cluster_columns <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(m) <span style="color:#a6e22e">as.dendrogram</span>(<span style="color:#a6e22e">agnes</span>(m)), 
        column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;clutering functions&#34;</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/xstMjzacOkgR5BI.png" alt="ComplexHeatmap-1.16.png"></p>
<p>　　在行列比较多的情况下，速度又成为了一个需求。我们就可以使用 <code>fastcluster</code> 来加速聚类，如下展示两种方式，其效果是一样的，自己运行一下看看就行了：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># 使用 fastcluster 加快聚类速度</span>
fh <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(x) fastcluster<span style="color:#f92672">::</span><span style="color:#a6e22e">hclust</span>(<span style="color:#a6e22e">dist</span>(x))
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, cluster_rows <span style="color:#f92672">=</span> fh, cluster_columns <span style="color:#f92672">=</span> fh)

<span style="color:#75715e"># 将fastcluster作为默认聚类方法</span>
ht_opt<span style="color:#f92672">$</span>fast_hclust <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span> <span style="color:#75715e"># used in all heatmaps</span>

group <span style="color:#f92672">=</span> <span style="color:#a6e22e">kmeans</span>(<span style="color:#a6e22e">t</span>(mat), centers <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)<span style="color:#f92672">$</span>cluster
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, cluster_columns <span style="color:#f92672">=</span> <span style="color:#a6e22e">cluster_within_group</span>(mat, group))

<span style="color:#a6e22e">ht_opt</span>(RESET <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>) <span style="color:#75715e"># 重置为默认配置</span>
</code></pre></div><h4 id="133-render-dendrograms">1.3.3 Render dendrograms</h4>
<p>树图同样也可以使用默认和传入已经构好的，展示如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">library</span>(dendextend)
row_dend <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.dendrogram</span>(<span style="color:#a6e22e">hclust</span>(<span style="color:#a6e22e">dist</span>(mat)))
row_dend <span style="color:#f92672">=</span> <span style="color:#a6e22e">color_branches</span>(row_dend, k <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>) <span style="color:#75715e"># `color_branches()` returns a dendrogram object</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, cluster_rows <span style="color:#f92672">=</span> row_dend)

<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, cluster_rows <span style="color:#f92672">=</span> row_dend, row_dend_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>)) <span style="color:#75715e"># 树图颜色</span>
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/s4iOtPCUwfvJ1cb.png" alt="ComplexHeatmap-1.17.png"></p>
<h4 id="134-reorder-dendrograms">1.3.4 Reorder dendrograms</h4>
<p>　　可以使用 <code>row_dend_reorder</code> 参数来对聚类后的结果进行排序，也可以使用 <code>cluster_rows</code> 在外面排序好之后再传入。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">m2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">100</span>, nr <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>, byrow <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#a6e22e">Heatmap</span>(m2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, row_dend_reorder <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;no reordering&#34;</span>)
<span style="color:#a6e22e">Heatmap</span>(m2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, row_dend_reorder <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;apply reordering&#34;</span>)

<span style="color:#75715e"># 使用 dendsort 再排序后传入</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;default reordering&#34;</span>)
<span style="color:#a6e22e">library</span>(dendsort)
dend <span style="color:#f92672">=</span> <span style="color:#a6e22e">dendsort</span>(<span style="color:#a6e22e">hclust</span>(<span style="color:#a6e22e">dist</span>(mat)))
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, cluster_rows <span style="color:#f92672">=</span> dend, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;reorder by dendsort&#34;</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/bNDiftwgLJavZqp.png" alt="ComplexHeatmap-1.18.png"></p>
<h3 id="14-set-row-and-column-orders">1.4 Set row and column orders</h3>
<p>　　当然聚类并不是必须的，也可以不聚类，使用自定义的顺序，只需在 <code>row_order/column_order</code> 中传入一个所需顺序的行列名的向量即可。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, 
        row_order <span style="color:#f92672">=</span> <span style="color:#a6e22e">order</span>(<span style="color:#a6e22e">as.numeric</span>(<span style="color:#a6e22e">gsub</span>(<span style="color:#e6db74">&#34;row&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">rownames</span>(mat)))), 
        column_order <span style="color:#f92672">=</span> <span style="color:#a6e22e">order</span>(<span style="color:#a6e22e">as.numeric</span>(<span style="color:#a6e22e">gsub</span>(<span style="color:#e6db74">&#34;column&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">colnames</span>(mat)))))

<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, 
        row_order <span style="color:#f92672">=</span> <span style="color:#a6e22e">sort</span>(<span style="color:#a6e22e">rownames</span>(mat)), 
        column_order <span style="color:#f92672">=</span> <span style="color:#a6e22e">sort</span>(<span style="color:#a6e22e">colnames</span>(mat)))
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/1u3cQbyCJtxI9AY.png" alt="ComplexHeatmap-1.19.png"></p>
<h3 id="15-dimension-names">1.5 Dimension names</h3>
<p>下面是名称相关设置的一些参数的说明。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, 
        row_names_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>, column_names_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;top&#34;</span>, <span style="color:#75715e"># 行/列名位置</span>
        row_dend_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;right&#34;</span>, column_dend_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>) <span style="color:#75715e"># 行/列树图位置</span>

<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, show_row_names <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#75715e"># 不显示行名</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat3&#34;</span>, row_names_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>, <span style="color:#75715e"># 行名大小</span>
                                               col <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#a6e22e">rep</span>(<span style="color:#e6db74">&#34;red&#34;</span>, <span style="color:#ae81ff">10</span>), <span style="color:#a6e22e">rep</span>(<span style="color:#e6db74">&#34;blue&#34;</span>, <span style="color:#ae81ff">8</span>)))) <span style="color:#75715e"># 行名颜色</span>

<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat4&#34;</span>, 
        row_names_centered <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, <span style="color:#75715e"># 行名居中</span>
        column_names_centered <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>) <span style="color:#75715e"># 列名居中</span>

<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat5&#34;</span>, 
        column_names_rot <span style="color:#f92672">=</span> <span style="color:#ae81ff">45</span>, <span style="color:#75715e">#列名旋转角度 </span>
        column_names_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;top&#34;</span>, <span style="color:#75715e">#列名位置</span>
        column_dend_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>) <span style="color:#75715e">#列树图位置</span>
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/cFGqg8kr4xYzeoK.png" alt="ComplexHeatmap-1.20.png"></p>
<p>如果名称太长可以使用 <code>row_names_max_width</code> 来显示过长的名字。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">mat2 <span style="color:#f92672">=</span> mat
<span style="color:#a6e22e">rownames</span>(mat2)[1] <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste</span>(<span style="color:#a6e22e">c</span>(<span style="color:#66d9ef">letters</span>, <span style="color:#66d9ef">LETTERS</span>), collapse <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>)
<span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>)
<span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, 
        row_names_max_width <span style="color:#f92672">=</span> <span style="color:#a6e22e">max_text_width</span>(
          <span style="color:#a6e22e">rownames</span>(mat2), 
          gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>)
        ))
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/XFAeUVWPkKn6Ir5.png" alt="ComplexHeatmap-1.21.png"></p>
<p>　　上面右图虽然过长的名字显示了，但是热图基本看不见了，这是由于存图时候的宽度过小，<strong>保存图片的时候宽度给足</strong>就可以了。</p>
<p>　　可以使用 <code>row_labels/column_labels</code> 修改行/列名，并且支持数学表达式。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">row_labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">structure</span>(<span style="color:#a6e22e">paste0</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">24</span>], <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">24</span>), names <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;row&#34;</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">24</span>))
column_labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">structure</span>(<span style="color:#a6e22e">paste0</span>(<span style="color:#66d9ef">LETTERS</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">24</span>], <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">24</span>), names <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;column&#34;</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">24</span>))
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, 
        row_labels <span style="color:#f92672">=</span> row_labels<span style="color:#a6e22e">[rownames</span>(mat)], 
        column_labels <span style="color:#f92672">=</span> column_labels<span style="color:#a6e22e">[colnames</span>(mat)])

<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, 
        row_labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">expression</span>(alpha, beta, gamma, delta, epsilon,
                                zeta, eta, theta, iota, kappa, lambda,
                                mu, nu, xi, omicron, <span style="color:#66d9ef">pi</span>, rho, sigma))
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/ljSFPyoGEchz7K5.png" alt="ComplexHeatmap-1.22.png"></p>
<h3 id="16-heatmap-split">1.6 Heatmap split</h3>
<p>　　可以用来分割热图的参数有 <code>row_km, row_split</code>, <code>column_km</code> 和 <code>column_split</code>，下面会一一说明，注意理解示例即可。</p>
<h4 id="161-split-by-k-means-clustering">1.6.1 Split by k-means clustering</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, 
        row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, <span style="color:#75715e"># 行按照km分割</span>
        column_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>) <span style="color:#75715e"># 列按照km分割</span>
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/V15RMcpzmJngN8b.png" alt="ComplexHeatmap-1.23.png"></p>
<h4 id="162-split-by-categorical-variables">1.6.2 Split by categorical variables</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># split by a vector</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, 
        row_split <span style="color:#f92672">=</span> <span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;A&#34;</span>, <span style="color:#e6db74">&#34;B&#34;</span>), <span style="color:#ae81ff">9</span>), 
        column_split <span style="color:#f92672">=</span> <span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;C&#34;</span>, <span style="color:#e6db74">&#34;D&#34;</span>), <span style="color:#ae81ff">12</span>))

<span style="color:#75715e"># split by a data frame</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, 
        row_split <span style="color:#f92672">=</span> <span style="color:#a6e22e">data.frame</span>(<span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;A&#34;</span>, <span style="color:#e6db74">&#34;B&#34;</span>), <span style="color:#ae81ff">9</span>), 
                               <span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;C&#34;</span>, <span style="color:#e6db74">&#34;D&#34;</span>), each <span style="color:#f92672">=</span> <span style="color:#ae81ff">9</span>)))

<span style="color:#75715e"># split on both dimensions</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, 
        row_split <span style="color:#f92672">=</span> <span style="color:#a6e22e">factor</span>(<span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;A&#34;</span>, <span style="color:#e6db74">&#34;B&#34;</span>), <span style="color:#ae81ff">9</span>)),
        column_split <span style="color:#f92672">=</span> <span style="color:#a6e22e">factor</span>(<span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;C&#34;</span>, <span style="color:#e6db74">&#34;D&#34;</span>), <span style="color:#ae81ff">12</span>)))
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/eGkqy3pEtY1murb.png" alt="ComplexHeatmap-1.24.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, 
        row_split <span style="color:#f92672">=</span> <span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;A&#34;</span>, <span style="color:#e6db74">&#34;B&#34;</span>), <span style="color:#ae81ff">9</span>), 
        row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)

<span style="color:#75715e"># 本质是split by a data frame</span>
cl <span style="color:#f92672">=</span> <span style="color:#a6e22e">kmeans</span>(mat, centers <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)<span style="color:#f92672">$</span>cluster
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, row_split <span style="color:#f92672">=</span> <span style="color:#a6e22e">cbind</span>(cl, <span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;A&#34;</span>, <span style="color:#e6db74">&#34;B&#34;</span>), <span style="color:#ae81ff">9</span>)))

<span style="color:#75715e"># 本质是split by a vector</span>
pa <span style="color:#f92672">=</span> cluster<span style="color:#f92672">::</span><span style="color:#a6e22e">pam</span>(mat, k <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat3&#34;</span>, row_split <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;pam&#34;</span>, pa<span style="color:#f92672">$</span>clustering))

<span style="color:#75715e"># remember when `row_order` is set, row clustering is turned off</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat4&#34;</span>, row_order <span style="color:#f92672">=</span> <span style="color:#ae81ff">18</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)


<span style="color:#75715e"># Character matrix can only be split by row_split/column_split argument.</span>
<span style="color:#75715e"># split by the first column in `discrete_mat`</span>
discrete_mat <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>], <span style="color:#ae81ff">100</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>), <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span>)
<span style="color:#a6e22e">Heatmap</span>(discrete_mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat5&#34;</span>, col <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>, row_split <span style="color:#f92672">=</span> discrete_mat[, <span style="color:#ae81ff">1</span>])

<span style="color:#75715e"># 去除分割标记的虚线 show_parent_dend_line</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat6&#34;</span>, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, column_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, show_parent_dend_line <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/KVgrNwTmnPlGE59.png" alt="ComplexHeatmap-1.25.png"></p>
<h4 id="163-split-by-dendrogram">1.6.3 Split by dendrogram</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, row_split <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, column_split <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)

dend <span style="color:#f92672">=</span> <span style="color:#a6e22e">hclust</span>(<span style="color:#a6e22e">dist</span>(mat))
dend <span style="color:#f92672">=</span> dendextend<span style="color:#f92672">::</span><span style="color:#a6e22e">color_branches</span>(dend, k <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, cluster_rows <span style="color:#f92672">=</span> dend, row_split <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)

split <span style="color:#f92672">=</span> <span style="color:#a6e22e">data.frame</span>(<span style="color:#a6e22e">cutree</span>(<span style="color:#a6e22e">hclust</span>(<span style="color:#a6e22e">dist</span>(mat)), k <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>), <span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;A&#34;</span>, <span style="color:#e6db74">&#34;B&#34;</span>), <span style="color:#ae81ff">9</span>))
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat3&#34;</span>, row_split <span style="color:#f92672">=</span> split, show_parent_dend_line <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/PFZOh6AeEak4JQD.png" alt="ComplexHeatmap-1.26.png"></p>
<h4 id="164-order-of-slices">1.6.4 Order of slices</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, 
        row_split <span style="color:#f92672">=</span> <span style="color:#a6e22e">rep</span>(<span style="color:#66d9ef">LETTERS</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], <span style="color:#ae81ff">6</span>),
        column_split <span style="color:#f92672">=</span> <span style="color:#a6e22e">rep</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>], <span style="color:#ae81ff">4</span>))

<span style="color:#75715e"># clustering is similar as previous heatmap with branches in some nodes in the dendrogram flipped</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, 
        row_split <span style="color:#f92672">=</span> <span style="color:#a6e22e">factor</span>(<span style="color:#a6e22e">rep</span>(<span style="color:#66d9ef">LETTERS</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], <span style="color:#ae81ff">6</span>), levels <span style="color:#f92672">=</span> <span style="color:#66d9ef">LETTERS</span>[3<span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>]),
        column_split <span style="color:#f92672">=</span> <span style="color:#a6e22e">factor</span>(<span style="color:#a6e22e">rep</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>], <span style="color:#ae81ff">4</span>), levels <span style="color:#f92672">=</span> <span style="color:#66d9ef">letters</span>[6<span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>]))

<span style="color:#75715e"># 去除树图中分割标记的虚线以上的部分 cluster_row_slices/cluster_column_slices</span>
<span style="color:#75715e"># now the order is exactly what we set</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, 
        row_split <span style="color:#f92672">=</span> <span style="color:#a6e22e">factor</span>(<span style="color:#a6e22e">rep</span>(<span style="color:#66d9ef">LETTERS</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], <span style="color:#ae81ff">6</span>), levels <span style="color:#f92672">=</span> <span style="color:#66d9ef">LETTERS</span>[3<span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>]),
        column_split <span style="color:#f92672">=</span> <span style="color:#a6e22e">factor</span>(<span style="color:#a6e22e">rep</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>], <span style="color:#ae81ff">4</span>), levels <span style="color:#f92672">=</span> <span style="color:#66d9ef">letters</span>[6<span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>]),
        cluster_row_slices <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, 
        cluster_column_slices <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/CK3DqyZgLEMiTNt.png" alt="ComplexHeatmap-1.27.png"></p>
<h4 id="165-titles-for-splitting">1.6.5 Titles for splitting</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">split <span style="color:#f92672">=</span> <span style="color:#a6e22e">data.frame</span>(<span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;A&#34;</span>, <span style="color:#e6db74">&#34;B&#34;</span>), <span style="color:#ae81ff">9</span>), <span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;C&#34;</span>, <span style="color:#e6db74">&#34;D&#34;</span>), each <span style="color:#f92672">=</span> <span style="color:#ae81ff">9</span>))
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, row_split <span style="color:#f92672">=</span> split, row_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;%s|%s&#34;</span>)
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, row_split <span style="color:#f92672">=</span> split, row_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;%s\n%s&#34;</span>)
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat3&#34;</span>, row_split <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, row_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cluster_%s&#34;</span>)

<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat4&#34;</span>, row_split <span style="color:#f92672">=</span> split, row_title <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>)
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat5&#34;</span>, row_split <span style="color:#f92672">=</span> split, row_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;there are four slices&#34;</span>)
ht <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat6&#34;</span>, row_split <span style="color:#f92672">=</span> split, row_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;%s|%s&#34;</span>)
<span style="color:#a6e22e">draw</span>(ht, row_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;I am a row title&#34;</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/CIqeMj7pAiy1ow9.png" alt="ComplexHeatmap-1.28.png"></p>
<h4 id="166-graphic-parameters-for-splitting">1.6.6 Graphic parameters for splitting</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, 
        row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, row_title_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;red&#34;</span>, <span style="color:#e6db74">&#34;blue&#34;</span>), font <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>),
        row_names_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;orange&#34;</span>), fontsize <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">14</span>)),
        column_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, column_title_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;red&#34;</span>, <span style="color:#e6db74">&#34;blue&#34;</span>, <span style="color:#e6db74">&#34;green&#34;</span>), font <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>),
        column_names_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;orange&#34;</span>, <span style="color:#e6db74">&#34;purple&#34;</span>), fontsize <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">8</span>)))
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/eiOlnLzxDjp7MQ3.png" alt="ComplexHeatmap-1.29.png"></p>
<h4 id="167-gaps-between-slices">1.6.7 Gaps between slices</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, row_gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">5</span>, <span style="color:#e6db74">&#34;mm&#34;</span>))
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, row_gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>), <span style="color:#e6db74">&#34;mm&#34;</span>))
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/Q35J4DbtPNHj2vz.png" alt="ComplexHeatmap-1.30.png"></p>
<p>这里需要注意一下，分割后热图的边框就会改变。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, column_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, border <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, column_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, 
        row_gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;mm&#34;</span>), column_gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;mm&#34;</span>), border <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/K9m7YVbjTXqEcoi.png" alt="ComplexHeatmap-1.31.png"></p>
<h4 id="168-split-heatmap-annotations">1.6.8 Split heatmap annotations</h4>
<p>分割后注释也会随之分割。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, column_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>,
        top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">24</span>, bar1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">24</span>))),
        right_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">18</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>, bar2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">18</span>)))
        )
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/8AcotQYH4hvyS76.png" alt="ComplexHeatmap-1.32.png"></p>
<h3 id="17-heatmap-as-raster-image">1.7 Heatmap as raster image</h3>
<p>这里主要是比较不同质量参数保存图片后的文件大小。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(mat, use_raster <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, raster_quality <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)

<span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">123</span>)
mat2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">10000</span><span style="color:#f92672">*</span><span style="color:#ae81ff">100</span>), ncol <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>)
<span style="color:#a6e22e">pdf</span>(<span style="color:#e6db74">&#34;heatmap.pdf&#34;</span>, width <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>, height <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>)
<span style="color:#a6e22e">Heatmap</span>(mat2, cluster_rows <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, cluster_columns <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, use_raster <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
<span style="color:#a6e22e">dev.off</span>()

<span style="color:#a6e22e">pdf</span>(<span style="color:#e6db74">&#34;heatmap_raster_by_png.pdf&#34;</span>, width <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>, height <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>)
<span style="color:#a6e22e">Heatmap</span>(mat2, cluster_rows <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, cluster_columns <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, use_raster <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, 
        raster_device <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;png&#34;</span>)
<span style="color:#a6e22e">dev.off</span>()

<span style="color:#a6e22e">pdf</span>(<span style="color:#e6db74">&#34;heatmap_raster_by_jpeg.pdf&#34;</span>, width <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>, height <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>)
<span style="color:#a6e22e">Heatmap</span>(mat2, cluster_rows <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, cluster_columns <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, use_raster <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, 
        raster_device <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;jpeg&#34;</span>)
<span style="color:#a6e22e">dev.off</span>()

<span style="color:#a6e22e">pdf</span>(<span style="color:#e6db74">&#34;heatmap_raster_by_tiff.pdf&#34;</span>, width <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>, height <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>)
<span style="color:#a6e22e">Heatmap</span>(mat2, cluster_rows <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, cluster_columns <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, use_raster <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, 
        raster_device <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tiff&#34;</span>)
<span style="color:#a6e22e">dev.off</span>()

<span style="color:#a6e22e">pdf</span>(<span style="color:#e6db74">&#34;heatmap_raster_by_CairoPNG.pdf&#34;</span>, width <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>, height <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>)
<span style="color:#a6e22e">Heatmap</span>(mat2, cluster_rows <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, cluster_columns <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, use_raster <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, 
        raster_device <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;CairoPNG&#34;</span>)
<span style="color:#a6e22e">dev.off</span>()

<span style="color:#a6e22e">pdf</span>(<span style="color:#e6db74">&#34;heatmap_raster_by_CairoJPEG.pdf&#34;</span>, width <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>, height <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>)
<span style="color:#a6e22e">Heatmap</span>(mat2, cluster_rows <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, cluster_columns <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, use_raster <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, 
        raster_device <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;CairoJPEG&#34;</span>)
dev.off

all_files <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;heatmap.pdf&#34;</span>, <span style="color:#e6db74">&#34;heatmap_raster_by_png.pdf&#34;</span>, 
              <span style="color:#e6db74">&#34;heatmap_raster_by_jpeg.pdf&#34;</span>, <span style="color:#e6db74">&#34;heatmap_raster_by_tiff.pdf&#34;</span>,
              <span style="color:#e6db74">&#34;heatmap_raster_by_CairoPNG.pdf&#34;</span>, <span style="color:#e6db74">&#34;heatmap_raster_by_CairoJPEG.pdf&#34;</span>)
fs <span style="color:#f92672">=</span> <span style="color:#a6e22e">file.size</span>(all_files)
<span style="color:#a6e22e">names</span>(fs) <span style="color:#f92672">=</span> all_files
<span style="color:#a6e22e">sapply</span>(fs, <span style="color:#a6e22e">function</span>(x) <span style="color:#a6e22e">paste</span>(<span style="color:#a6e22e">round</span>(x<span style="color:#f92672">/</span><span style="color:#ae81ff">1024</span>), <span style="color:#e6db74">&#34;KB&#34;</span>))
</code></pre></div><h3 id="18-customize-the-heatmap-body">1.8 Customize the heatmap body</h3>
<h4 id="181-cell_fun">1.8.1 cell_fun</h4>
<p>　<code>cell_fun</code> draws in each cell repeatedly, with 7 arguments.</p>
<ul>
<li><code>j</code>: column index in the matrix. Column index corresponds to the x-direction in the viewport, that&rsquo;s why j is put as the first argument.</li>
<li><code>i</code>: row index in the matrix.</li>
<li><code>x</code>: x coordinate of middle point of the cell which is measured in the viewport of the heatmap body.</li>
<li><code>y</code>: y coordinate of middle point of the cell which is measured in the viewport of the heatmap body.</li>
<li><code>width</code>: width of the cell. The value is unit(1/ncol(sub_mat), &ldquo;npc&rdquo;) where sub_mat correspond to the sub-matrix by row splitting and column splitting.</li>
<li><code>height</code>: height of the cell. The value is unit(1/nrow(sub_mat), &ldquo;npc&rdquo;).</li>
<li><code>fill</code>: color of the cell.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">small_mat <span style="color:#f92672">=</span> mat[1<span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>]
col_fun <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-2</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>))
<span style="color:#a6e22e">Heatmap</span>(small_mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, col <span style="color:#f92672">=</span> col_fun,
        cell_fun <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(j, i, x, y, width, height, fill) {
          <span style="color:#a6e22e">grid.text</span>(<span style="color:#a6e22e">sprintf</span>(<span style="color:#e6db74">&#34;%.1f&#34;</span>, small_mat[i, j]), x, y, gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>))
        })

<span style="color:#a6e22e">Heatmap</span>(small_mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>,  col <span style="color:#f92672">=</span> col_fun,
        cell_fun <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(j, i, x, y, width, height, fill) {
          <span style="color:#a6e22e">if</span>(small_mat[i, j] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>)
            <span style="color:#a6e22e">grid.text</span>(<span style="color:#a6e22e">sprintf</span>(<span style="color:#e6db74">&#34;%.1f&#34;</span>, small_mat[i, j]), x, y, gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>))
        })

<span style="color:#a6e22e">Heatmap</span>(small_mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat3&#34;</span>, col <span style="color:#f92672">=</span> col_fun,
        row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, column_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>,
        cell_fun <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(j, i, x, y, width, height, fill) {
          <span style="color:#a6e22e">grid.text</span>(<span style="color:#a6e22e">sprintf</span>(<span style="color:#e6db74">&#34;%.1f&#34;</span>, small_mat[i, j]), x, y, gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>))
        })
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/xylReFZ5S8IrOQC.png" alt="ComplexHeatmap-1.33.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">cor_mat <span style="color:#f92672">=</span> <span style="color:#a6e22e">cor</span>(small_mat)
od <span style="color:#f92672">=</span> <span style="color:#a6e22e">hclust</span>(<span style="color:#a6e22e">dist</span>(cor_mat))<span style="color:#f92672">$</span>order
cor_mat <span style="color:#f92672">=</span> cor_mat[od, od]
nm <span style="color:#f92672">=</span> <span style="color:#a6e22e">rownames</span>(cor_mat)
col_fun <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>))
<span style="color:#75715e"># `col = col_fun` here is used to generate the legend</span>
<span style="color:#a6e22e">Heatmap</span>(cor_mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;correlation&#34;</span>, col <span style="color:#f92672">=</span> col_fun, rect_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;none&#34;</span>), 
        cell_fun <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(j, i, x, y, width, height, fill) {
          <span style="color:#a6e22e">grid.rect</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y, width <span style="color:#f92672">=</span> width, height <span style="color:#f92672">=</span> height, 
                    gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;grey&#34;</span>, fill <span style="color:#f92672">=</span> <span style="color:#66d9ef">NA</span>))
          <span style="color:#a6e22e">if</span>(i <span style="color:#f92672">==</span> j) {
            <span style="color:#a6e22e">grid.text</span>(nm[i], x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y)
          } else <span style="color:#a6e22e">if</span>(i <span style="color:#f92672">&gt;</span> j) {
            <span style="color:#a6e22e">grid.circle</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y, r <span style="color:#f92672">=</span> <span style="color:#a6e22e">abs</span>(cor_mat[i, j])<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">min</span>(<span style="color:#a6e22e">unit.c</span>(width, height)), 
                        gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">col_fun</span>(cor_mat[i, j]), col <span style="color:#f92672">=</span> <span style="color:#66d9ef">NA</span>))
          } else {
            <span style="color:#a6e22e">grid.text</span>(<span style="color:#a6e22e">sprintf</span>(<span style="color:#e6db74">&#34;%.1f&#34;</span>, cor_mat[i, j]), x, y, gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>))
          }
        }, cluster_rows <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, cluster_columns <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>,
        show_row_names <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, show_column_names <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/OIS9bRtzg2GkZJq.png" alt="ComplexHeatmap-1.34.png"></p>
<h4 id="182-layer_fun">1.8.2 layer_fun</h4>
<p>　<code>cell_fun</code> adds graphics cell by cell, while <code>layer_fun</code> adds graphics in a block-wise manner.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">mfoo <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>, nr <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)
mfoo[1<span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>)]
<span style="color:#75715e"># but we actually want mfoo[1, 1] and mfoo[2, 3]</span>
<span style="color:#a6e22e">pindex</span>(mfoo, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>))

col_fun <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-2</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>))
<span style="color:#a6e22e">Heatmap</span>(small_mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, col <span style="color:#f92672">=</span> col_fun,
        layer_fun <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(j, i, x, y, width, height, fill) {
          <span style="color:#75715e"># since grid.text can also be vectorized</span>
          <span style="color:#a6e22e">grid.text</span>(<span style="color:#a6e22e">sprintf</span>(<span style="color:#e6db74">&#34;%.1f&#34;</span>, <span style="color:#a6e22e">pindex</span>(small_mat, i, j)), x, y, gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>))
        })

<span style="color:#a6e22e">Heatmap</span>(small_mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, col <span style="color:#f92672">=</span> col_fun, 
        layer_fun <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(j, i, x, y, width, height, fill) {
          v <span style="color:#f92672">=</span> <span style="color:#a6e22e">pindex</span>(small_mat, i, j)
          l <span style="color:#f92672">=</span> v <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>
          <span style="color:#a6e22e">grid.text</span>(<span style="color:#a6e22e">sprintf</span>(<span style="color:#e6db74">&#34;%.1f&#34;</span>, v[l]), x[l], y[l], gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>))
        })

<span style="color:#a6e22e">Heatmap</span>(small_mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat3&#34;</span>, col <span style="color:#f92672">=</span> col_fun,
        row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, column_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>,
        layer_fun <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(j, i, x, y, width, height, fill) {
          v <span style="color:#f92672">=</span> <span style="color:#a6e22e">pindex</span>(small_mat, i, j)
          <span style="color:#a6e22e">grid.text</span>(<span style="color:#a6e22e">sprintf</span>(<span style="color:#e6db74">&#34;%.1f&#34;</span>, v), x, y, gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>))
          <span style="color:#a6e22e">if</span>(<span style="color:#a6e22e">sum</span>(v <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>)<span style="color:#f92672">/</span><span style="color:#a6e22e">length</span>(v) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.75</span>) {
            <span style="color:#a6e22e">grid.rect</span>(gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;transparent&#34;</span>))
          }
        })

<span style="color:#a6e22e">Heatmap</span>(small_mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat4&#34;</span>, col <span style="color:#f92672">=</span> col_fun,
        row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, column_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>,
        layer_fun <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(j, i, x, y, width, height, fill, slice_r, slice_c) {
          v <span style="color:#f92672">=</span> <span style="color:#a6e22e">pindex</span>(small_mat, i, j)
          <span style="color:#a6e22e">grid.text</span>(<span style="color:#a6e22e">sprintf</span>(<span style="color:#e6db74">&#34;%.1f&#34;</span>, v), x, y, gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>))
          <span style="color:#a6e22e">if</span>(slice_r <span style="color:#f92672">!=</span> slice_c) {
            <span style="color:#a6e22e">grid.rect</span>(gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;transparent&#34;</span>))
          }
        })
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/8mBOi5V6Jl1XZQU.png" alt="ComplexHeatmap-1.35.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(small_mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, col <span style="color:#f92672">=</span> col_fun,
        row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, column_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>,
        layer_fun <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(j, i, x, y, w, h, fill) {
          <span style="color:#75715e"># restore_matrix() is explained after this chunk of code</span>
          ind_mat <span style="color:#f92672">=</span> <span style="color:#a6e22e">restore_matrix</span>(j, i, x, y)
          <span style="color:#a6e22e">for</span>(ir in <span style="color:#a6e22e">seq_len</span>(<span style="color:#a6e22e">nrow</span>(ind_mat))) {
            <span style="color:#75715e"># start from the second column</span>
            <span style="color:#a6e22e">for</span>(ic in <span style="color:#a6e22e">seq_len</span>(<span style="color:#a6e22e">ncol</span>(ind_mat))[<span style="color:#ae81ff">-1</span>]) {
              ind1 <span style="color:#f92672">=</span> ind_mat[ir, ic<span style="color:#ae81ff">-1</span>] <span style="color:#75715e"># previous column</span>
              ind2 <span style="color:#f92672">=</span> ind_mat[ir, ic]   <span style="color:#75715e"># current column</span>
              v1 <span style="color:#f92672">=</span> small_mat[i[ind1], j[ind1]]
              v2 <span style="color:#f92672">=</span> small_mat[i[ind2], j[ind2]]
              <span style="color:#a6e22e">if</span>(v1 <span style="color:#f92672">*</span> v2 <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) { <span style="color:#75715e"># if they have the same sign</span>
                col <span style="color:#f92672">=</span> <span style="color:#a6e22e">ifelse</span>(v1 <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;darkred&#34;</span>, <span style="color:#e6db74">&#34;darkgreen&#34;</span>)
                <span style="color:#a6e22e">grid.segments</span>(x[ind1], y[ind1], x[ind2], y[ind2],
                              gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> col, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>))
                <span style="color:#a6e22e">grid.points</span>(x<span style="color:#a6e22e">[c</span>(ind1, ind2)], y<span style="color:#a6e22e">[c</span>(ind1, ind2)], 
                            pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>, gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> col), size <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;mm&#34;</span>))
              }
            }
          }
        })
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/Nn6mWJObx4ZLoFI.png" alt="ComplexHeatmap-1.36.png"></p>
<h3 id="19-size-of-the-heatmap">1.9 Size of the heatmap</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># 控制热图主体尺寸</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">8</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">8</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))

<span style="color:#75715e"># 控制热图尺寸（包括注释和图例）</span>
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, heatmap_width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">8</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), heatmap_height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">8</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/VzsbqPE7hR2iv3w.png" alt="ComplexHeatmap-1.37.png"></p>
<p>　　为了更加明显的展示尺寸关系，上图是以 600·600 的大小保存的，并在后期加上黑边框。</p>
<h3 id="110-get-orders-and-dendrograms">1.10 Get orders and dendrograms</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ht <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(small_mat)
ht <span style="color:#f92672">=</span> <span style="color:#a6e22e">draw</span>(ht)

<span style="color:#a6e22e">row_order</span>(ht)
<span style="color:#a6e22e">column_order</span>(ht)
</code></pre></div><h3 id="111-subset-a-heatmap">1.11 Subset a heatmap</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ht <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)
ht
ht[1<span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>]
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/8qWxZP5bJMSm9BL.png" alt="ComplexHeatmap-1.38.png"></p>
<p>　　上图可以看出来，此功能本质是<strong>取输入的矩阵的子集</strong>，再画热图。换个思路，在括号中填入所需顺序，此功能不就可以实现在不聚类的情况下的重新排序吗！</p>
<h2 id="2-heatmap-annotations">2 Heatmap Annotations</h2>
<p>　　正式开始说明之前，先准备一下矩阵和简单秀下画热图注释的相关代码。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># 构建矩阵</span>
<span style="color:#a6e22e">rm</span>(list <span style="color:#f92672">=</span> <span style="color:#a6e22e">ls</span>())
<span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">123</span>)
mat <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>)
<span style="color:#a6e22e">rownames</span>(mat) <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;R&#34;</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>)
<span style="color:#a6e22e">colnames</span>(mat) <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;C&#34;</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">column_ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>), bar1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>)))
row_ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>), bar2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>)))
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, top_annotation <span style="color:#f92672">=</span> column_ha, right_annotation <span style="color:#f92672">=</span> row_ha)

<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, bottom_annotation <span style="color:#f92672">=</span> column_ha, left_annotation <span style="color:#f92672">=</span> row_ha)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/59ELxnuFYPbqtoA.png" alt="ComplexHeatmap-2.1.png"></p>
<h3 id="21-simple-annotation">2.1 Simple annotation</h3>
<p>简单注释，就是利用不同颜色来展示行/列中不同的信息。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># 用1到10作注释</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>)
<span style="color:#a6e22e">draw</span>(ha)

<span style="color:#75715e"># 用abc字母作注释</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], <span style="color:#ae81ff">10</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>))
<span style="color:#a6e22e">draw</span>(ha)

<span style="color:#75715e"># 渐变色映射1到10作注释</span>
col_fun <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">10</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;blue&#34;</span>, <span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>))
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, col <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(foo <span style="color:#f92672">=</span> col_fun))
<span style="color:#a6e22e">draw</span>(ha)

<span style="color:#75715e"># abc字母作注释并分别指定不同的颜色</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], <span style="color:#ae81ff">10</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
                       col <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;a&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blue&#34;</span>)))
<span style="color:#a6e22e">draw</span>(ha)

<span style="color:#75715e"># 组合前面两种注释，并分别指定不同的颜色</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(
  foo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, 
  bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], <span style="color:#ae81ff">10</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
  col <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(foo <span style="color:#f92672">=</span> col_fun,
             bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;a&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blue&#34;</span>)
  )
)
<span style="color:#a6e22e">draw</span>(ha)
</code></pre></div><p>下图依次是上面五种示例的结果：</p>
<p><img src="https://i.loli.net/2020/05/12/WetEndQiAG2pKf5.png" alt="ComplexHeatmap-2.2.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># NA value</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(
  foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>, <span style="color:#66d9ef">NA</span>, <span style="color:#ae81ff">6</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>), 
  bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#66d9ef">NA</span>, <span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], <span style="color:#ae81ff">9</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)),
  col <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(foo <span style="color:#f92672">=</span> col_fun,
             bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;a&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blue&#34;</span>)),
  na_col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>
)
<span style="color:#a6e22e">draw</span>(ha)

<span style="color:#75715e"># 每个格子的边框</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(
  foo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, 
  bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], <span style="color:#ae81ff">10</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
  col <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(foo <span style="color:#f92672">=</span> col_fun,
             bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;a&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blue&#34;</span>)
  ),
  gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>)
)
<span style="color:#a6e22e">draw</span>(ha)

<span style="color:#75715e"># 两行注释的两种方式</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">cbind</span>(a <span style="color:#f92672">=</span> <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>), b <span style="color:#f92672">=</span> <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>)))
<span style="color:#a6e22e">draw</span>(ha)
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">cbind</span>(<span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>), <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>)))
<span style="color:#a6e22e">draw</span>(ha)
</code></pre></div><p>下图依次是上面四种示例的结果：</p>
<p><img src="https://i.loli.net/2020/05/12/OTgGNhqKv3JZXBF.png" alt="ComplexHeatmap-2.3.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># 制作数据框传入</span>
anno_df <span style="color:#f92672">=</span> <span style="color:#a6e22e">data.frame</span>(foo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>,
                     bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], <span style="color:#ae81ff">10</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>))
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(df <span style="color:#f92672">=</span> anno_df,
                       col <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(foo <span style="color:#f92672">=</span> col_fun,
                                  bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;a&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blue&#34;</span>)
                       )
)
<span style="color:#a6e22e">draw</span>(ha)

<span style="color:#75715e"># 数据框和额外注释</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(df <span style="color:#f92672">=</span> anno_df,
                       foo2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">10</span>),
                       col <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(foo <span style="color:#f92672">=</span> col_fun,
                                  bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;a&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blue&#34;</span>)
                       )
)
<span style="color:#a6e22e">draw</span>(ha)

<span style="color:#75715e"># 每个注释的边框 border</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(
  foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">cbind</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>),
  bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], <span style="color:#ae81ff">10</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
  col <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(foo <span style="color:#f92672">=</span> col_fun,
             bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;a&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blue&#34;</span>)
  ),
  border <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>
)
<span style="color:#a6e22e">draw</span>(ha)

<span style="color:#75715e"># 注释的尺寸 simple_anno_size</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(
  foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">cbind</span>(a <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, b <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>), 
  bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], <span style="color:#ae81ff">10</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
  col <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(foo <span style="color:#f92672">=</span> col_fun,
             bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;a&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blue&#34;</span>)
  ),
  simple_anno_size <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)
)
<span style="color:#a6e22e">draw</span>(ha)
</code></pre></div><p>下图依次是上面四种示例的结果：</p>
<p><img src="https://i.loli.net/2020/05/12/neGm2Ub7RafcB9W.png" alt="ComplexHeatmap-2.4.png"></p>
<h3 id="22-simple-annotation-as-an-annotation-function">2.2 Simple annotation as an annotation function</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_simple</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, 
                                         pch <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>, <span style="color:#66d9ef">NA</span>, <span style="color:#ae81ff">6</span><span style="color:#f92672">:</span><span style="color:#ae81ff">8</span>, <span style="color:#66d9ef">NA</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">11</span>), <span style="color:#75715e">#形状</span>
                                         pt_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>), pt_size <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#34;mm&#34;</span>)))
<span style="color:#a6e22e">draw</span>(ha)

ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_simple</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, 
                                         pch <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], <span style="color:#ae81ff">10</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)))
<span style="color:#a6e22e">draw</span>(ha)

ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_simple</span>(<span style="color:#a6e22e">cbind</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>), pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>))
<span style="color:#a6e22e">draw</span>(ha)

<span style="color:#75715e"># pch通过matrix传入</span>
pch <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">20</span>, nc <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)
pch<span style="color:#a6e22e">[sample</span>(<span style="color:#a6e22e">length</span>(pch), <span style="color:#ae81ff">10</span>)] <span style="color:#f92672">=</span> <span style="color:#66d9ef">NA</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_simple</span>(<span style="color:#a6e22e">cbind</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>), pch <span style="color:#f92672">=</span> pch))
<span style="color:#a6e22e">draw</span>(ha)
</code></pre></div><p>下图依次是上面四种示例的结果：</p>
<p><img src="https://i.loli.net/2020/05/12/ZDpPemovrxB1zhN.png" alt="ComplexHeatmap-2.5.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">123</span>)
pvalue <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>^<span style="color:#f92672">-</span><span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>, min <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, max <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)
is_sig <span style="color:#f92672">=</span> pvalue <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0.01</span>
pch <span style="color:#f92672">=</span> <span style="color:#a6e22e">rep</span>(<span style="color:#e6db74">&#34;*&#34;</span>, <span style="color:#ae81ff">10</span>)
pch[<span style="color:#f92672">!</span>is_sig] <span style="color:#f92672">=</span> <span style="color:#66d9ef">NA</span>
<span style="color:#75715e"># color mapping for -log10(pvalue)</span>
pvalue_col_fun <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>)) 
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(
  pvalue <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_simple</span>(<span style="color:#f92672">-</span><span style="color:#a6e22e">log10</span>(pvalue), col <span style="color:#f92672">=</span> pvalue_col_fun, pch <span style="color:#f92672">=</span> pch),
  annotation_name_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>)
ht <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha)
<span style="color:#75715e"># now we generate two legends, one for the p-value</span>
<span style="color:#75715e"># see how we define the legend for pvalue</span>
lgd_pvalue <span style="color:#f92672">=</span> <span style="color:#a6e22e">Legend</span>(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;p-value&#34;</span>, col <span style="color:#f92672">=</span> pvalue_col_fun, at <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>), 
                    labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;1&#34;</span>, <span style="color:#e6db74">&#34;0.1&#34;</span>, <span style="color:#e6db74">&#34;0.01&#34;</span>, <span style="color:#e6db74">&#34;0.001&#34;</span>))
<span style="color:#75715e"># and one for the significant p-values</span>
lgd_sig <span style="color:#f92672">=</span> <span style="color:#a6e22e">Legend</span>(pch <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;*&#34;</span>, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;points&#34;</span>, labels <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&lt; 0.01&#34;</span>)
<span style="color:#75715e"># these two self-defined legends are added to the plot by `annotation_legend_list`</span>
<span style="color:#a6e22e">draw</span>(ht, annotation_legend_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(lgd_pvalue, lgd_sig))
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/yrvwG4faT9lY7sm.png" alt="ComplexHeatmap-2.6.png"></p>
<h3 id="23-empty-annotation">2.3 Empty annotation</h3>
<p>使用 anno_empty 获得空白注释，具体有什么用可以参考下面两个例子。</p>
<p><strong>示例1</strong>：利用空白注释在右侧加上行名</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">random_text <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(n) {
  <span style="color:#a6e22e">sapply</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>n, <span style="color:#a6e22e">function</span>(i) {
    <span style="color:#a6e22e">paste0</span>(<span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>, <span style="color:#a6e22e">sample</span>(<span style="color:#ae81ff">4</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">1</span>)), collapse <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>)
  })
}
text_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(
  text1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">random_text</span>(<span style="color:#ae81ff">4</span>),
  text2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">random_text</span>(<span style="color:#ae81ff">4</span>),
  text3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">random_text</span>(<span style="color:#ae81ff">4</span>),
  text4 <span style="color:#f92672">=</span> <span style="color:#a6e22e">random_text</span>(<span style="color:#ae81ff">4</span>)
)
<span style="color:#75715e"># note how we set the width of this empty annotation</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_empty</span>(border <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, 
                                    width <span style="color:#f92672">=</span> <span style="color:#a6e22e">max_text_width</span>(<span style="color:#a6e22e">unlist</span>(text_list)) <span style="color:#f92672">+</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;mm&#34;</span>)))
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">1000</span>), nrow <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>, right_annotation <span style="color:#f92672">=</span> ha)
<span style="color:#a6e22e">for</span>(i in <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>) {
  <span style="color:#a6e22e">decorate_annotation</span>(<span style="color:#e6db74">&#34;foo&#34;</span>, slice <span style="color:#f92672">=</span> i, {
    <span style="color:#a6e22e">grid.rect</span>(x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;mm&#34;</span>), gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> i, col <span style="color:#f92672">=</span> <span style="color:#66d9ef">NA</span>), just <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>)
    <span style="color:#a6e22e">grid.text</span>(<span style="color:#a6e22e">paste</span>(text_list[[i]], collapse <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;\n&#34;</span>), x <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;mm&#34;</span>), just <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>)
  })
}
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/Q932o7gTt4SCmpk.png" alt="ComplexHeatmap-2.7.png"></p>
<p><strong>示例2</strong>：利用空白注释在上方添加画散点图的位置</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_empty</span>(border <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)))
ht <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), nrow <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha)
ht <span style="color:#f92672">=</span> <span style="color:#a6e22e">draw</span>(ht)
co <span style="color:#f92672">=</span> <span style="color:#a6e22e">column_order</span>(ht)
value <span style="color:#f92672">=</span> <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>)
<span style="color:#a6e22e">decorate_annotation</span>(<span style="color:#e6db74">&#34;foo&#34;</span>, {
  <span style="color:#75715e"># value on x-axis is always 1:ncol(mat)</span>
  x <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>
  <span style="color:#75715e"># while values on y-axis is the value after column reordering</span>
  value <span style="color:#f92672">=</span> value[co]
  <span style="color:#a6e22e">pushViewport</span>(<span style="color:#a6e22e">viewport</span>(xscale <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">10.5</span>), yscale <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)))
  <span style="color:#a6e22e">grid.lines</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">10.5</span>), <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.5</span>), gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(lty <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>),
             default.units <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;native&#34;</span>)
  <span style="color:#a6e22e">grid.points</span>(x, value, pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>, size <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;mm&#34;</span>),
              gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#a6e22e">ifelse</span>(value <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.5</span>, <span style="color:#e6db74">&#34;red&#34;</span>, <span style="color:#e6db74">&#34;blue&#34;</span>)), default.units <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;native&#34;</span>)
  <span style="color:#a6e22e">grid.yaxis</span>(at <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">1</span>))
  <span style="color:#a6e22e">popViewport</span>()
})
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/opJxtOY3n1QyLzb.png" alt="ComplexHeatmap-2.8.png"></p>
<h3 id="24-block-annotation">2.4 Block annotation</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>,
        top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_block</span>(gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>))),
        column_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)


<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), 
        top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_block</span>(gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>),
                                                            labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;group1&#34;</span>, <span style="color:#e6db74">&#34;group2&#34;</span>, <span style="color:#e6db74">&#34;group3&#34;</span>), 
                                                            labels_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>, fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>))),
        column_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>,
        left_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_block</span>(gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>),
                                                         labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;group1&#34;</span>, <span style="color:#e6db74">&#34;group2&#34;</span>, <span style="color:#e6db74">&#34;group3&#34;</span>), 
                                                         labels_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>, fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>))),
        row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/aQ45dr3qMLSsPec.png" alt="ComplexHeatmap-2.9.png"></p>
<h3 id="25-points-annotation">2.5 Points annotation</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># 一组数值</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>,
        top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>)))) 
<span style="color:#75715e"># 两组数值</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>,
        top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">20</span>), nc <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>), 
                                                             pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>, gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>))))
<span style="color:#75715e"># 点注释参数设置</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat3&#34;</span>,
        top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>), 
                                                             ylim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>), <span style="color:#75715e"># y轴范围</span>
                                                             height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), <span style="color:#75715e"># 高度</span>
                                                             axis_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>( <span style="color:#75715e"># 坐标轴设置</span>
                                                               side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>, <span style="color:#75715e"># 位置</span>
                                                               at <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">1</span>), <span style="color:#75715e"># 刻度</span>
                                                               labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;zero&#34;</span>, <span style="color:#e6db74">&#34;half&#34;</span>, <span style="color:#e6db74">&#34;one&#34;</span>) <span style="color:#75715e"># 标记</span>
                                                             ))))
<span style="color:#75715e"># 注意是行注释和列注释的参数区别</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat4&#34;</span>,
        left_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>), 
                                                          ylim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>),
                                                          width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), <span style="color:#75715e"># 宽度</span>
                                                          axis_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(
                                                            side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>,
                                                            at <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">1</span>), 
                                                            labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;zero&#34;</span>, <span style="color:#e6db74">&#34;half&#34;</span>, <span style="color:#e6db74">&#34;one&#34;</span>),
                                                            labels_rot <span style="color:#f92672">=</span> <span style="color:#ae81ff">45</span> <span style="color:#75715e"># 标记旋转角度</span>
                                                          ))))
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/HgUWPmaYfvlXrKo.png" alt="ComplexHeatmap-2.10.png"></p>
<h3 id="26-lines-annotation">2.6 Lines annotation</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># 一组数值</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>,
        top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_lines</span>(<span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>)))) 
<span style="color:#75715e"># 两组数值</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>,
        top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_lines</span>(<span style="color:#a6e22e">cbind</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span>), <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">5</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>)), 
                                                            gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>), add_points <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, 
                                                            pt_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>), pch <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">16</span>)))) 
<span style="color:#75715e"># 平滑曲线</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat3&#34;</span>,
        top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_lines</span>(<span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>), 
                                                            smooth <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, <span style="color:#75715e"># 平滑曲线</span>
                                                            height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)))) <span style="color:#75715e">#高度</span>
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/hgp6d2HIocjavPK.png" alt="ComplexHeatmap-2.11.png"></p>
<h3 id="27-barplot-annotation">2.7 Barplot annotation</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># 默认</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>,
        top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>)))

<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>,
        top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, bar_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, <span style="color:#75715e"># 柱宽（0-1）</span>
                                                              gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>)))) <span style="color:#75715e"># 填充色</span>

<span style="color:#75715e"># 设置基线  &#34;min&#34; &#34;max&#34; or a numeric value</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat3&#34;</span>,
        top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">-5</span>, <span style="color:#ae81ff">4</span>), baseline <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;min&#34;</span>)))
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat4&#34;</span>,
        top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">-5</span>, <span style="color:#ae81ff">4</span>), baseline <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)))
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/X9JwFL6kfB7SMTr.png" alt="ComplexHeatmap-2.12.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># 堆积图</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>,
        top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#a6e22e">cbind</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>), 
                                                              gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>, col <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>),
                                                              height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)))) <span style="color:#75715e"># 高度</span>
<span style="color:#75715e"># 百分比堆积图</span>
m <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">4</span><span style="color:#f92672">*</span><span style="color:#ae81ff">10</span>), nc <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>)
m <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>(<span style="color:#a6e22e">apply</span>(m, <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">function</span>(x) x<span style="color:#f92672">/</span><span style="color:#a6e22e">sum</span>(x)))
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>,
        top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(m, gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span>), 
                                                              bar_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, 
                                                              height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))))

<span style="color:#75715e"># 翻转  reverse</span>
ha_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(axis_reverse <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(m, gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span>), 
                                                    axis_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(direction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;reverse&#34;</span>), 
                                                    bar_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">rowAnnotation</span>(axis_normal <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(m, gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span>), 
                                           bar_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)))
<span style="color:#a6e22e">draw</span>(ha_list, ht_gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;mm&#34;</span>)) <span style="color:#75715e"># 注释间距离</span>
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/VYPmTtk6I1hJdZE.png" alt="ComplexHeatmap-2.13.png"></p>
<h3 id="28-boxplot-annotation">2.8 Boxplot annotation</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">12345</span>)
m <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>)

ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_boxplot</span>(m, height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))) <span style="color:#75715e"># 高度</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>,top_annotation <span style="color:#f92672">=</span> ha)

ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_boxplot</span>(m, height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>))) <span style="color:#75715e"># 填充色</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>,top_annotation <span style="color:#f92672">=</span> ha)

ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_boxplot</span>(m, height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), 
                                          box_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.9</span>, <span style="color:#75715e"># 箱体宽度</span>
                                          outline <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)) <span style="color:#75715e"># 去除异常值</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat3&#34;</span>,top_annotation <span style="color:#f92672">=</span> ha)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/dVJoEX5nBusCkb1.png" alt="ComplexHeatmap-2.14.png"></p>
<h3 id="29-histogram-annotation">2.9 Histogram annotation</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">m <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">1000</span>), nc <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>)
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_histogram</span>(m)) <span style="color:#75715e"># apply `m` on rows</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>,right_annotation <span style="color:#f92672">=</span> ha)

ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_histogram</span>(m, n_breaks <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>, <span style="color:#75715e"># 设置刻度大小</span>
                                        gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>))) <span style="color:#75715e"># 设置填充色</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>,right_annotation <span style="color:#f92672">=</span> ha)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/W1dnfSDCqxtOENz.png" alt="ComplexHeatmap-2.15.png"></p>
<h3 id="210-density-annotation">2.10 Density annotation</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_density</span>(m))
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>,right_annotation <span style="color:#f92672">=</span> ha)

<span style="color:#75715e"># Joyplot</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_density</span>(m, joyplot_scale <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, 
                                      gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#e41a1c60&#34;</span>), <span style="color:#75715e"># 使用带有透明度的颜色填充</span>
                                      border <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)) <span style="color:#75715e"># 去除边框</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>,right_annotation <span style="color:#f92672">=</span> ha)

<span style="color:#75715e"># type:&#34;violine&#34; for violin plot </span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_density</span>(m, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;violin&#34;</span>, 
                                      gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>)))
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat3&#34;</span>,right_annotation <span style="color:#f92672">=</span> ha)

<span style="color:#75715e"># type:&#34;heatmap&#34; for heatmap visualization of density distribution </span>
m2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">50</span><span style="color:#f92672">*</span><span style="color:#ae81ff">10</span>), nrow <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>)
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_density</span>(m2, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;heatmap&#34;</span>, 
                                      width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">6</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))) <span style="color:#75715e"># 宽度</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat4&#34;</span>,right_annotation <span style="color:#f92672">=</span> ha)


ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_density</span>(m2, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;heatmap&#34;</span>, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">6</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), 
                                      heatmap_colors <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;orange&#34;</span>))) <span style="color:#75715e"># 热图颜色</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat5&#34;</span>,right_annotation <span style="color:#f92672">=</span> ha)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/V4HLxEPgchS5kBs.png" alt="ComplexHeatmap-2.16.png"></p>
<h3 id="211-joyplot-annotation">2.11 Joyplot annotation</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">m <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">1000</span>), nc <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>)
lt <span style="color:#f92672">=</span> <span style="color:#a6e22e">apply</span>(m, <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">function</span>(x) <span style="color:#a6e22e">data.frame</span>(<span style="color:#a6e22e">density</span>(x)<span style="color:#a6e22e">[c</span>(<span style="color:#e6db74">&#34;x&#34;</span>, <span style="color:#e6db74">&#34;y&#34;</span>)]))
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_joyplot</span>(lt, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), <span style="color:#75715e"># 宽度</span>
                                      gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>), <span style="color:#75715e"># 填充色</span>
                                      transparency <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.75</span>, <span style="color:#75715e"># 透明度</span>
                                      scale <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)) <span style="color:#75715e"># 相对高度,1为界限</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>,right_annotation <span style="color:#f92672">=</span> ha)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/KGrQOi6UnZA8b9e.png" alt="ComplexHeatmap-2.17.png"></p>
<h3 id="212-horizon-chart-annotation">2.12 Horizon chart annotation</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># 一个list</span>
lt <span style="color:#f92672">=</span> <span style="color:#a6e22e">lapply</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">function</span>(x) <span style="color:#a6e22e">cumprod</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">1000</span>, <span style="color:#f92672">-</span>x<span style="color:#f92672">/</span><span style="color:#ae81ff">100</span>, x<span style="color:#f92672">/</span><span style="color:#ae81ff">100</span>)) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
<span style="color:#75715e"># 默认效果</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_horizon</span>(lt))
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>,right_annotation <span style="color:#f92672">=</span> ha)

<span style="color:#75715e"># 负值翻转 negative_from_top</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_horizon</span>(lt, negative_from_top <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>))
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>,right_annotation <span style="color:#f92672">=</span> ha)

<span style="color:#75715e"># 颜色及间隔</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_horizon</span>(lt,gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(pos_fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;orange&#34;</span>, <span style="color:#75715e"># 负值填充色</span>
                                                   neg_fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;darkgreen&#34;</span>), <span style="color:#75715e"># 正值填充色</span>
                                      gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;mm&#34;</span>))) <span style="color:#75715e"># 间隔</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat3&#34;</span>,right_annotation <span style="color:#f92672">=</span> ha)

<span style="color:#75715e"># 也可以填充颜色的向量</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_horizon</span>(lt, gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(pos_fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;orange&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>), each <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>),
                                                    neg_fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;darkgreen&#34;</span>, <span style="color:#e6db74">&#34;blue&#34;</span>), each <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>))))
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat4&#34;</span>,right_annotation <span style="color:#f92672">=</span> ha)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/Tu2MK8GS93BAF6l.png" alt="ComplexHeatmap-2.18.png"></p>
<h3 id="213-text-annotation">2.13 Text annotation</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_text</span>(month.name[1<span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>], 
                                   gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12+4</span>), <span style="color:#75715e"># 大小</span>
                                   rot <span style="color:#f92672">=</span> <span style="color:#ae81ff">30</span>, <span style="color:#75715e"># 角度</span>
                                   location <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#75715e"># 位置</span>
                                   just <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>)) <span style="color:#75715e"># 对齐方式(&#34;left&#34;, &#34;right&#34;, &#34;centre&#34;, &#34;center&#34;, &#34;bottom&#34;, and &#34;top&#34; )</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>,right_annotation <span style="color:#f92672">=</span> ha)

ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_text</span>(month.name[1<span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>], location <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>, just <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;center&#34;</span>,
                                   gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#75715e"># 背景填充色</span>
                                             col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#75715e"># 文字颜色 </span>
                                             border <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>), <span style="color:#75715e"># 边框颜色</span>
                                   width <span style="color:#f92672">=</span> <span style="color:#a6e22e">max_text_width</span>(month.name)<span style="color:#f92672">*</span><span style="color:#ae81ff">1.2</span>)) <span style="color:#75715e"># 宽度</span>
<span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>,right_annotation <span style="color:#f92672">=</span> ha)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/uw8rTciV4ENKnIf.png" alt="ComplexHeatmap-2.19.png"></p>
<h3 id="214-mark-annotation">2.14 Mark annotation</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">m <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">1000</span>), nrow <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>)
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_mark</span>(at <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">60</span>, <span style="color:#ae81ff">97</span><span style="color:#f92672">:</span><span style="color:#ae81ff">100</span>), 
                                   labels <span style="color:#f92672">=</span> month.name[1<span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>],
                                   link_width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#34;mm&#34;</span>), <span style="color:#75715e">#线长度</span>
                                   padding <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">5</span>, <span style="color:#e6db74">&#34;mm&#34;</span>), <span style="color:#75715e"># 标签间隔</span>
                                   extend <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;mm&#34;</span>)))
<span style="color:#a6e22e">Heatmap</span>(m, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, cluster_rows <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, right_annotation <span style="color:#f92672">=</span> ha)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/njypPz8aiZSDh2d.png" alt="ComplexHeatmap-2.20.png"></p>
<h3 id="215-summary-annotation">2.15 Summary annotation</h3>
<p>统计划分后的每个区块的相关信息。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># 条形图</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(summary <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_summary</span>(height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)))
v <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>], <span style="color:#ae81ff">50</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
split <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>], <span style="color:#ae81ff">50</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)

<span style="color:#a6e22e">Heatmap</span>(v, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, col <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;a&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blue&#34;</span>),
        top_annotation <span style="color:#f92672">=</span> ha, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), row_split <span style="color:#f92672">=</span> split)

<span style="color:#75715e"># 箱线图</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(summary <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_summary</span>(gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>), 
                                              height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)))
v <span style="color:#f92672">=</span> <span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">50</span>)
<span style="color:#a6e22e">Heatmap</span>(v, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), 
        row_split <span style="color:#f92672">=</span> split)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/Zzn41b2aP9XrguV.png" alt="ComplexHeatmap-2.21.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">m <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">50</span><span style="color:#f92672">*</span><span style="color:#ae81ff">10</span>), nrow <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>)
ht_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(m, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;main_matrix&#34;</span>)

ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(summary <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_summary</span>(height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)))
v <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>], <span style="color:#ae81ff">50</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
ht_list <span style="color:#f92672">=</span> ht_list <span style="color:#f92672">+</span> <span style="color:#a6e22e">Heatmap</span>(v, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))

ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(summary <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_summary</span>(gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>), 
                                              height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)))
v <span style="color:#f92672">=</span> <span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">50</span>)
ht_list <span style="color:#f92672">=</span> ht_list <span style="color:#f92672">+</span> <span style="color:#a6e22e">Heatmap</span>(v, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))

split <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>], <span style="color:#ae81ff">50</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
lgd_boxplot <span style="color:#f92672">=</span> <span style="color:#a6e22e">Legend</span>(labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;group a&#34;</span>, <span style="color:#e6db74">&#34;group b&#34;</span>), title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;group&#34;</span>,
                     legend_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;red&#34;</span>, <span style="color:#e6db74">&#34;blue&#34;</span>)))
<span style="color:#a6e22e">draw</span>(ht_list, row_split <span style="color:#f92672">=</span> split, ht_gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">5</span>, <span style="color:#e6db74">&#34;mm&#34;</span>), 
     heatmap_legend_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(lgd_boxplot))
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/vbhx5Nm1jKyHWqd.png" alt="ComplexHeatmap-2.22.png"></p>
<h3 id="216-zoom-annotation">2.16 Zoom annotation</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">123</span>)
m <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span><span style="color:#f92672">*</span><span style="color:#ae81ff">10</span>), nrow <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>)
subgroup <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], <span style="color:#ae81ff">100</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, prob <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">10</span>))
rg <span style="color:#f92672">=</span> <span style="color:#a6e22e">range</span>(m)
panel_fun <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(index, nm) {
  <span style="color:#a6e22e">pushViewport</span>(<span style="color:#a6e22e">viewport</span>(xscale <span style="color:#f92672">=</span> rg, yscale <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>)))
  <span style="color:#a6e22e">grid.rect</span>()
  <span style="color:#a6e22e">grid.xaxis</span>(gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>))
  <span style="color:#a6e22e">grid.boxplot</span>(m[index, ], pos <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, direction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;horizontal&#34;</span>)
  <span style="color:#a6e22e">popViewport</span>()
}
anno <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_zoom</span>(align_to <span style="color:#f92672">=</span> subgroup, <span style="color:#75715e"># 用哪些画图</span>
                 which <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;row&#34;</span>, 
                 panel_fun <span style="color:#f92672">=</span> panel_fun, <span style="color:#75715e"># 怎么画图</span>
                 size <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), 
                 gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), 
                 width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))
<span style="color:#a6e22e">Heatmap</span>(m, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, right_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> anno), row_split <span style="color:#f92672">=</span> subgroup)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/6jQN2sLY7chqaPy.png" alt="ComplexHeatmap-2.23.png"></p>
<h3 id="217-multiple-annotations">2.17 Multiple annotations</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">123</span>)
mat <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>)

ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, 
                       bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">cbind</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>),
                       pt <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>),
                       <span style="color:#75715e"># show_legend = c(bar = FALSE),</span>
                       show_legend <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(T,F), <span style="color:#75715e"># 是否显示图例</span>
                       show_annotation_name <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(T,T,F), <span style="color:#75715e"># 是否显示注释名</span>
                       border <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(F,T) ,<span style="color:#75715e"># 是否显示边框</span>
                       gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">4</span>), <span style="color:#e6db74">&#34;mm&#34;</span>)
                       )
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha)

ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, 
                       bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">cbind</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>),
                       pt <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>),
                       gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>) <span style="color:#75715e"># 线条或边框的颜色</span>
)
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/f4lOGKbBLIk8vjR.png" alt="ComplexHeatmap-2.24.png"></p>
<h3 id="218-size-of-annotations">2.18 Size of annotations</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">cbind</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>), 
                       bar <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>,
                       pt <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>))
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha)

<span style="color:#75715e"># annotation_height 直接添加长度单位</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">cbind</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>), 
                       bar <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>,
                       pt <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>),
                       annotation_height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/19fxQvTc5NnjrkW.png" alt="ComplexHeatmap-2.25.png"></p>
<ul>
<li><code>height</code> ：确定总的注释高度</li>
<li><code>annotation_height</code> ：确定每个注释比例。</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># foo: 2cm, bar: 4cm, pt: 6cm</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">cbind</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>), 
                       bar <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>,
                       pt <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>),
                       annotation_height <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>, height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">12</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha)


<span style="color:#75715e"># foo: 1.5cm, bar: 1.5cm, pt: 3cm</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">cbind</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>), 
                       bar <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>,
                       pt <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>),
                       annotation_height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;null&#34;</span>, <span style="color:#e6db74">&#34;null&#34;</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)), height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">6</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha)


<span style="color:#75715e"># foo: 2cm, bar: 1cm, pt: 3cm</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">cbind</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>), 
                       bar <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>,
                       pt <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>),
                       annotation_height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;cm&#34;</span>, <span style="color:#e6db74">&#34;null&#34;</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)), height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">6</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))
<span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat3&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/DGadElpHgR3FwX9.png" alt="ComplexHeatmap-2.26.png"></p>
<h3 id="219-utility-functions">2.19 Utility functions</h3>
<p>这里主要介绍一些比较实用的小功能。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, 
                       bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">cbind</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>),
                       pt <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>))
<span style="color:#a6e22e">length</span>(ha) <span style="color:#75715e"># 注释个数</span>
<span style="color:#a6e22e">nobs</span>(ha) <span style="color:#75715e">#行数</span>
<span style="color:#a6e22e">names</span>(ha) <span style="color:#75715e"># 注释名</span>

<span style="color:#a6e22e">names</span>(ha) <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;FOO&#34;</span>, <span style="color:#e6db74">&#34;BAR&#34;</span>, <span style="color:#e6db74">&#34;PT&#34;</span>) <span style="color:#75715e"># 重命名注释名</span>
<span style="color:#a6e22e">names</span>(ha)
</code></pre></div><p>多个注释也是一样的。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ha1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, 
                        bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">cbind</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>),
                        pt <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>))
ha2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(FOO <span style="color:#f92672">=</span> <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>), 
                        BAR <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span>), <span style="color:#ae81ff">10</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
                        PT <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">10</span>)))
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(ha1, ha2)
<span style="color:#a6e22e">names</span>(ha)
</code></pre></div><h3 id="220-implement-new-annotation-functions">2.20 Implement new annotation functions</h3>
<p>自定义注释。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">x <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>
anno1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">AnnotationFunction</span>(
  fun <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(index, k, n) {
    n <span style="color:#f92672">=</span> <span style="color:#a6e22e">length</span>(index)
    <span style="color:#a6e22e">pushViewport</span>(<span style="color:#a6e22e">viewport</span>(xscale <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.5</span>, n <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.5</span>), yscale <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">10</span>)))
    <span style="color:#a6e22e">grid.rect</span>()
    <span style="color:#a6e22e">grid.points</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>n, x[index], default.units <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;native&#34;</span>)
    <span style="color:#a6e22e">if</span>(k <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) <span style="color:#a6e22e">grid.yaxis</span>()
    <span style="color:#a6e22e">popViewport</span>()
  },
  var_import <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(x <span style="color:#f92672">=</span> x),
  n <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>,
  subsetable <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>,
  height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)
)
anno1

m <span style="color:#f92672">=</span> <span style="color:#a6e22e">rbind</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">11</span><span style="color:#f92672">:</span><span style="color:#ae81ff">20</span>)
<span style="color:#a6e22e">Heatmap</span>(m, top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> anno1))
<span style="color:#a6e22e">Heatmap</span>(m, top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> anno1), 
        column_split <span style="color:#f92672">=</span> <span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;A&#34;</span>, <span style="color:#e6db74">&#34;B&#34;</span>), each <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>))
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/MKBtxH3JPrZ6592.png" alt="ComplexHeatmap-2.27.png"></p>
<h2 id="3-a-list-of-heatmaps">3 A List of Heatmaps</h2>
<p>　　本节主要就是介绍怎么样组合多个热图。老样子先构建矩阵。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">123</span>)
mat1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">80</span>, <span style="color:#ae81ff">2</span>), <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">10</span>)
mat1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">rbind</span>(mat1, <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">40</span>, <span style="color:#ae81ff">-2</span>), <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">10</span>))
<span style="color:#a6e22e">rownames</span>(mat1) <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;R&#34;</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>)
<span style="color:#a6e22e">colnames</span>(mat1) <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;C&#34;</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>)

mat2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">60</span>, max <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, min <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>), <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">10</span>)
mat2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">rbind</span>(mat2, <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">60</span>, max <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, min <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>), <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">10</span>))
<span style="color:#a6e22e">rownames</span>(mat2) <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;R&#34;</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>)
<span style="color:#a6e22e">colnames</span>(mat2) <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;C&#34;</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>)

le <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], <span style="color:#ae81ff">12</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#a6e22e">names</span>(le) <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;R&#34;</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>)

ind <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">12</span>)
mat1 <span style="color:#f92672">=</span> mat1[ind, ]
mat2 <span style="color:#f92672">=</span> mat2[ind, ]
le <span style="color:#f92672">=</span> le[ind]
</code></pre></div><p>　　上面构建了mat1, mat2 和 le 三个矩阵，最简单粗暴的组合方式就是利用 <code>+</code> 来完成热图之间的组合，可以自己先运行下面的代码简单感受一下花式组合，后面再继续介绍相关参数的设置。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>)
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>)
ht3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(le, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;letters&#34;</span>)

ht1 <span style="color:#f92672">+</span> ht2 <span style="color:#f92672">+</span> ht3
ht_list <span style="color:#f92672">=</span> ht1 <span style="color:#f92672">+</span> ht2 <span style="color:#f92672">+</span> ht3
ht1 <span style="color:#f92672">+</span> ht_list
ht_list <span style="color:#f92672">+</span> ht1
ht_list <span style="color:#f92672">+</span> ht_list
</code></pre></div><p>　　在介绍单个热图制作的时候，提到过循环出图的问题。现在了解了组合，我们可以先用一个 <code>list</code> 来存储热图。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ht_list <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>  <span style="color:#75715e">## Heatmap(...) + NULL gives you a HeatmapList object</span>
<span style="color:#a6e22e">for</span>(s in sth) {
  ht_list <span style="color:#f92672">=</span> ht_list <span style="color:#f92672">+</span> <span style="color:#a6e22e">Heatmap</span>(<span style="color:#66d9ef">...</span>)
}
</code></pre></div><h3 id="31-titles">3.1 Titles</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">col_rnorm <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-3</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">3</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>))
col_runif <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">3</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;orange&#34;</span>))
col_letters <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;a&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;pink&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;purple&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blue&#34;</span>)

ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm,
              row_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Heatmap 1&#34;</span>, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Heatmap 1&#34;</span>)
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>, col <span style="color:#f92672">=</span> col_runif,
              row_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Heatmap 2&#34;</span>, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Heatmap 2&#34;</span>)
ht3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(le, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;letters&#34;</span>, col <span style="color:#f92672">=</span> col_letters)
ht_list <span style="color:#f92672">=</span> ht1 <span style="color:#f92672">+</span> ht2 <span style="color:#f92672">+</span> ht3

<span style="color:#a6e22e">draw</span>(ht_list, 
     row_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Three heatmaps, row title&#34;</span>, <span style="color:#75715e"># 行标题</span>
     row_title_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>), <span style="color:#75715e"># 行标题名参数</span>
     column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Three heatmaps, column title&#34;</span>, <span style="color:#75715e"># 列标题</span>
     column_title_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>)) <span style="color:#75715e"># 列标题参数</span>
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/4sjcAHgXCvh7Iil.png" alt="ComplexHeatmap-3.1.png"></p>
<h3 id="32-size-of-heatmaps">3.2 Size of heatmaps</h3>
<p>参数后传入长度。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>, col <span style="color:#f92672">=</span> col_runif, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">6</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))
ht3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(le, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;letters&#34;</span>, col <span style="color:#f92672">=</span> col_letters, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))
ht1 <span style="color:#f92672">+</span> ht2 <span style="color:#f92672">+</span> ht3
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/MPE53dumHbDsVLT.png" alt="ComplexHeatmap-3.2.png"></p>
<p>参数后传入比例，如下直接填入数字即可。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm, width <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>)
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>, col <span style="color:#f92672">=</span> col_runif, width <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>)
ht3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(le, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;letters&#34;</span>, col <span style="color:#f92672">=</span> col_letters, width <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
ht1 <span style="color:#f92672">+</span> ht2 <span style="color:#f92672">+</span> ht3
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/U2KCgG53Wo4lBaI.png" alt="ComplexHeatmap-3.3.png"></p>
<h3 id="33-gap-between-heatmaps">3.3 Gap between heatmaps</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm)
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>, col <span style="color:#f92672">=</span> col_runif)
ht3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(le, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;letters&#34;</span>, col <span style="color:#f92672">=</span> col_letters)
ht_list <span style="color:#f92672">=</span> ht1 <span style="color:#f92672">+</span> ht2 <span style="color:#f92672">+</span> ht3
<span style="color:#a6e22e">draw</span>(ht_list, ht_gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;mm&#34;</span>))
<span style="color:#a6e22e">draw</span>(ht_list, ht_gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">10</span>), <span style="color:#e6db74">&#34;mm&#34;</span>))
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/oYZgRmcDbkFeOqh.png" alt="ComplexHeatmap-3.4.png"></p>
<h3 id="34-automatic-adjustment-to-the-main-heatmap">3.4 Automatic adjustment to the main heatmap</h3>
<p>热图的行聚类及切割效果均以主热图为基准，默认放在最前面的为主热图。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>, col <span style="color:#f92672">=</span> col_runif)
ht3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(le, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;letters&#34;</span>, col <span style="color:#f92672">=</span> col_letters)
ht2 <span style="color:#f92672">+</span> ht1 <span style="color:#f92672">+</span> ht3 <span style="color:#75715e"># ht2 is the main heatmap and row_km in ht1 is ignored</span>
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/AUsuMJzyKXwYEqo.png" alt="ComplexHeatmap-3.5.png"></p>
<p>下面是一些相关参数的示例：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ht_list <span style="color:#f92672">=</span> ht2 <span style="color:#f92672">+</span> ht1 <span style="color:#f92672">+</span> ht3
<span style="color:#a6e22e">draw</span>(ht_list, main_heatmap <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, <span style="color:#75715e"># 调整主热图</span>
     row_dend_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;right&#34;</span>, <span style="color:#75715e"># 行树图位置</span>
     row_sub_title_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>) <span style="color:#75715e"># 行子标题位置</span>
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/ryfYiOq3MJICPmF.png" alt="ComplexHeatmap-3.6.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm)
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>, col <span style="color:#f92672">=</span> col_runif)
ht3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(le, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;letters&#34;</span>, col <span style="color:#f92672">=</span> col_letters)
ht_list <span style="color:#f92672">=</span> ht1 <span style="color:#f92672">+</span> ht2 <span style="color:#f92672">+</span> ht3
<span style="color:#a6e22e">draw</span>(ht_list, auto_adjust <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
<span style="color:#a6e22e">draw</span>(ht_list)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/CEYGq2pHVxPla6T.png" alt="ComplexHeatmap-3.7.png"></p>
<h3 id="35-control-main-heatmap-in-draw-function">3.5 Control main heatmap in draw() function</h3>
<p>In <code>draw()</code> function, following main heatmap settings control row orders of all heatmaps.</p>
<ul>
<li><code>cluster_rows</code></li>
<li><code>clustering_distance_rows</code></li>
<li><code>clustering_method_rows</code></li>
<li><code>row_dend_width</code></li>
<li><code>show_row_dend</code></li>
<li><code>row_dend_reorder</code></li>
<li><code>row_dend_gp</code></li>
<li><code>row_order</code></li>
</ul>
<p>Following settings control the row slices.</p>
<ul>
<li><code>row_gap</code></li>
<li><code>row_km</code></li>
<li><code>row_km_repeats</code></li>
<li><code>row_split</code></li>
</ul>
<p>Following settings control the heatmap height.</p>
<ul>
<li><code>height</code></li>
<li><code>heatmap_height</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, cluster_rows <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>, col <span style="color:#f92672">=</span> col_runif)
ht3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(le, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;letters&#34;</span>, col <span style="color:#f92672">=</span> col_letters)
ht_list <span style="color:#f92672">=</span> ht1 <span style="color:#f92672">+</span> ht2 <span style="color:#f92672">+</span> ht3
<span style="color:#a6e22e">draw</span>(ht_list, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, 
     row_split <span style="color:#f92672">=</span> le, 
     cluster_rows <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/TrPEKpJehXjdtF3.png" alt="ComplexHeatmap-3.8.png"></p>
<h3 id="36-annotations-as-components-are-adjusted">3.6 Annotations as components are adjusted</h3>
<p>　　每个热图<strong>不全是</strong>简单注释的热图会自动对齐注释，如果在注释中已经设定了注释的高度的是不能自动对齐的。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ha1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, 
                        bar1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>), 
                        annotation_name_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>)
ha2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(bar2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>))
ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm, top_annotation <span style="color:#f92672">=</span> ha1)
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>, col <span style="color:#f92672">=</span> col_runif, top_annotation <span style="color:#f92672">=</span> ha2)
ht3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(le, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;letters&#34;</span>, col <span style="color:#f92672">=</span> col_letters)
ht_list <span style="color:#f92672">=</span> ht1 <span style="color:#f92672">+</span> ht2 <span style="color:#f92672">+</span> ht3
<span style="color:#a6e22e">draw</span>(ht_list, ht_gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">2</span>), <span style="color:#e6db74">&#34;mm&#34;</span>)) 
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/uz2DkermPhgQNjV.png" alt="ComplexHeatmap-3.9.png"></p>
<p><strong>有和无注释</strong>的热图不能自动对齐注释。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ha1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, annotation_name_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>)
ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm, top_annotation <span style="color:#f92672">=</span> ha1)
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>, col <span style="color:#f92672">=</span> col_runif)
ht3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(le, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;letters&#34;</span>, col <span style="color:#f92672">=</span> col_letters)
ht1 <span style="color:#f92672">+</span> ht2 <span style="color:#f92672">+</span> ht3
</code></pre></div><p><img src="https://i.loli.net/2020/05/12/8pGRtb4HZWnMlkF.png" alt="ComplexHeatmap-3.10.png"></p>
<p>下面的情况就是至少有一个热图全是简单注释从而不能自动对齐。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ha1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, annotation_name_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>)
ha2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(bar2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)))
ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm, top_annotation <span style="color:#f92672">=</span> ha1)
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>, col <span style="color:#f92672">=</span> col_runif, top_annotation <span style="color:#f92672">=</span> ha2)
ht3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(le, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;letters&#34;</span>, col <span style="color:#f92672">=</span> col_letters)
ht_list <span style="color:#f92672">=</span> ht1 <span style="color:#f92672">+</span> ht2 <span style="color:#f92672">+</span> ht3
<span style="color:#a6e22e">draw</span>(ht_list, ht_gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">2</span>), <span style="color:#e6db74">&#34;mm&#34;</span>))

ha1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, annotation_name_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>)
ha2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(bar2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">cbind</span>(b1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, b2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">11</span><span style="color:#f92672">:</span><span style="color:#ae81ff">20</span>, b3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">21</span><span style="color:#f92672">:</span><span style="color:#ae81ff">30</span>))
ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm, top_annotation <span style="color:#f92672">=</span> ha1)
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>, col <span style="color:#f92672">=</span> col_runif, top_annotation <span style="color:#f92672">=</span> ha2)
ht3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(le, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;letters&#34;</span>, col <span style="color:#f92672">=</span> col_letters)
ht_list <span style="color:#f92672">=</span> ht1 <span style="color:#f92672">+</span> ht2 <span style="color:#f92672">+</span> ht3
<span style="color:#a6e22e">draw</span>(ht_list)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/38Ly7ZkNOPMQfgW.png" alt="ComplexHeatmap-3.11.png"></p>
<p>　　想要保持注释对齐的话，可以在 <code>HeatmapAnnotation</code> 中加 <code>simple_anno_size_adjust = TRUE</code>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ha1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, annotation_name_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>, simple_anno_size_adjust <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
ha2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(bar2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)))
ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm, top_annotation <span style="color:#f92672">=</span> ha1)
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>, col <span style="color:#f92672">=</span> col_runif, top_annotation <span style="color:#f92672">=</span> ha2)
ht3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(le, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;letters&#34;</span>, col <span style="color:#f92672">=</span> col_letters)
ht_list <span style="color:#f92672">=</span> ht1 <span style="color:#f92672">+</span> ht2 <span style="color:#f92672">+</span> ht3
<span style="color:#a6e22e">draw</span>(ht_list, ht_gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">2</span>), <span style="color:#e6db74">&#34;mm&#34;</span>))
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/gFCZzVkwPc38mGs.png" alt="ComplexHeatmap-3.12.png"></p>
<p>第二个热图无底部注释，第一个热图的列名会直接置于最下。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ha1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, bar1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>), annotation_name_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>)
ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm, bottom_annotation <span style="color:#f92672">=</span> ha1)
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>, col <span style="color:#f92672">=</span> col_runif)
ht3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(le, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;letters&#34;</span>, col <span style="color:#f92672">=</span> col_letters)
ht_list <span style="color:#f92672">=</span> ht1 <span style="color:#f92672">+</span> ht2 <span style="color:#f92672">+</span> ht3
<span style="color:#a6e22e">draw</span>(ht_list)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/A4sHDnCwM1yF26T.png" alt="ComplexHeatmap-3.13.png"></p>
<h3 id="37-concatenate-with-annotations">3.7 Concatenate with annotations</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># 热图和注释连接</span>
ha1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>, bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)))
ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)
ht1 <span style="color:#f92672">+</span> ha1

<span style="color:#75715e"># 下面代码等同上面</span>
<span style="color:#a6e22e">Heatmap</span>(mat1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">rowAnnotation</span>(bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)))
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/Y5SbnMarXvhBmoU.png" alt="ComplexHeatmap-3.14.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">Heatmap</span>(mat1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">rowAnnotation</span>(bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>, col <span style="color:#f92672">=</span> col_runif)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/knCdASmZXWxP2Yj.png" alt="ComplexHeatmap-3.15.png"></p>
<h3 id="38-concatenate-only-the-annotations">3.8 Concatenate only the annotations</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># 没有热图也是可以的</span>
<span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">rowAnnotation</span>(bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)))

<span style="color:#75715e"># 只有一个注释则必须额外加上NULL</span>
<span style="color:#a6e22e">rowAnnotation</span>(bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))) <span style="color:#f92672">+</span> <span style="color:#66d9ef">NULL</span>

<span style="color:#75715e"># 同样可以使用draw里面的功能进行操作</span>
anno_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">rowAnnotation</span>(bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)))
<span style="color:#a6e22e">draw</span>(anno_list, row_split <span style="color:#f92672">=</span> <span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;A&#34;</span>, <span style="color:#e6db74">&#34;B&#34;</span>), each <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>))

</code></pre></div><p><img src="https://i.loli.net/2020/05/13/1QscqSy8HxZXd3w.png" alt="ComplexHeatmap-3.16.png"></p>
<h3 id="39-vertical-concatenation">3.9 Vertical concatenation</h3>
<p><strong>纵向</strong>连接使用 <code>%v%</code> ,其余参数均类似于横向连接，下面代码可以自行体会。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">mat1t <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>(mat1)
mat2t <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>(mat2)
ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1t, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm, row_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>)
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2t, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>, col <span style="color:#f92672">=</span> col_runif, row_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>)
ht3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">rbind</span>(<span style="color:#66d9ef">letters</span> <span style="color:#f92672">=</span> le), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;letters&#34;</span>, col <span style="color:#f92672">=</span> col_letters)
ht_list <span style="color:#f92672">=</span> ht1 <span style="color:#f92672">%v%</span> ht2 <span style="color:#f92672">%v%</span> ht3
<span style="color:#a6e22e">draw</span>(ht_list)
<span style="color:#a6e22e">draw</span>(ht_list, column_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)

ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>, height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)))
ht_list <span style="color:#f92672">=</span> ht1 <span style="color:#f92672">%v%</span> ha <span style="color:#f92672">%v%</span> ht2 <span style="color:#f92672">%v%</span> ht3
<span style="color:#a6e22e">draw</span>(ht_list, column_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)

ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1t, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2t, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>, col <span style="color:#f92672">=</span> col_runif, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)
ht3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">rbind</span>(<span style="color:#66d9ef">letters</span> <span style="color:#f92672">=</span> le), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;letters&#34;</span>, col <span style="color:#f92672">=</span> col_letters)
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>, height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)))
ht_list <span style="color:#f92672">=</span> ht1 <span style="color:#f92672">%v%</span> ha <span style="color:#f92672">%v%</span> ht2 <span style="color:#f92672">%v%</span> ht3
<span style="color:#a6e22e">draw</span>(ht_list, column_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)

ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1t, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>,
              left_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, bar1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>)))
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>, height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), 
                                          axis_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;right&#34;</span>)))
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2t, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>, col <span style="color:#f92672">=</span> col_runif, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>,
              left_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>))
ht3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">rbind</span>(<span style="color:#66d9ef">letters</span> <span style="color:#f92672">=</span> le), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;letters&#34;</span>, col <span style="color:#f92672">=</span> col_letters)
ht_list <span style="color:#f92672">=</span> ht1 <span style="color:#f92672">%v%</span> ha <span style="color:#f92672">%v%</span> ht2 <span style="color:#f92672">%v%</span> ht3
<span style="color:#a6e22e">draw</span>(ht_list, column_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)
</code></pre></div><h3 id="310-subset-the-heatmap-list">3.10 Subset the heatmap list</h3>
<p>与前面画单个热图的亚集类似。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm, 
              left_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>, bar1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>)))
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>, col <span style="color:#f92672">=</span> col_runif)
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>), bar2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>)
ht_list <span style="color:#f92672">=</span> ht1 <span style="color:#f92672">+</span> ht2 <span style="color:#f92672">+</span> ha
<span style="color:#a6e22e">names</span>(ht_list)
<span style="color:#a6e22e">draw</span>(ht_list)
ht_list[1<span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;rnorm&#34;</span>, <span style="color:#e6db74">&#34;bar2&#34;</span>)]
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/HQS6Ez5FqpR4Mgf.png" alt="ComplexHeatmap-3.17.png"></p>
<h3 id="311-get-orders-and-dendrograms">3.11 Get orders and dendrograms</h3>
<p>同样与单个热图取顺序类似。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm)
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>, col <span style="color:#f92672">=</span> col_runif)
ht_list <span style="color:#f92672">=</span> ht1 <span style="color:#f92672">+</span> ht2
ht_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">draw</span>(ht_list)
<span style="color:#a6e22e">row_order</span>(ht_list)
<span style="color:#a6e22e">column_order</span>(ht_list)

<span style="color:#75715e"># 分割成多少块，获得的顺序也会化分成多少个</span>
ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, col <span style="color:#f92672">=</span> col_rnorm)
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>, col <span style="color:#f92672">=</span> col_runif, column_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)
ht_list <span style="color:#f92672">=</span> ht1 <span style="color:#f92672">+</span> ht2
ht_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">draw</span>(ht_list, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)
<span style="color:#a6e22e">row_order</span>(ht_list)
<span style="color:#a6e22e">column_order</span>(ht_list)

<span style="color:#75715e"># 只获得其中一部分的顺序</span>
<span style="color:#a6e22e">column_order</span>(ht_list, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;runif&#34;</span>)
</code></pre></div><h3 id="312-change-parameters-globally">3.12 Change parameters globally</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ht_opt
</code></pre></div><p>There are following parameters to control all heatmaps:</p>
<ul>
<li><code>heatmap_row_names_gp</code>: set <code>row_names_gp</code> in all <code>Heatmap().</code></li>
<li><code>heatmap_column_names_gp</code>: set <code>column_names_gp</code> in all <code>Heatmap()</code>.</li>
<li><code>heatmap_row_title_gp</code>: set <code>row_title_gp</code> in all <code>Heatmap()</code>.</li>
<li><code>heatmap_column_title_gp</code>: set <code>column_title_gp</code> in all <code>Heatmap()</code>.</li>
<li><code>heatmap_border</code>: set <code>border</code> in all <code>Heatmap()</code>.</li>
</ul>
<p>Following parameters control the legends:</p>
<ul>
<li><code>legend_title_gp</code>: set <code>title_gp</code> in all heatmap legends and annotation legends.</li>
<li><code>legend_title_position</code>: set <code>title_position</code> in all heatmap legends and annotation legends.</li>
<li><code>legend_labels_gp</code>: set <code>labels_gp</code> in all heatmap legends and annotation legends.</li>
<li><code>legend_grid_width</code>: set <code>grid_width</code> in all heatmap legends and annotation legends.</li>
<li><code>legend_grid_height</code>: set <code>grid_height</code> in all heatmap legends and annotation legends.</li>
<li><code>legend_border</code>: set <code>border</code> in all heatmap legends and annotation legends.</li>
</ul>
<p>Following parameters control heatmap annotations:</p>
<ul>
<li><code>annotation_border</code>: set <code>border</code> in all <code>HeatmapAnnotation()</code>.</li>
<li><code>anno_simple_size</code>: set size for the simple annotation.</li>
</ul>
<p>Following parameters control the space between heatmap components:</p>
<ul>
<li><code>DENDROGRAM_PADDING</code>: space bewteen dendrograms and heatmap body.</li>
<li><code>DIMNAME_PADDING</code>: space between row/column names and heatmap body.</li>
<li><code>TITLE_PADDING</code>: space between row/column titles and heatmap body.</li>
<li><code>COLUMN_ANNO_PADDING</code>: space between column annotations and heatmap body.</li>
<li><code>ROW_ANNO_PADDING</code>: space between row annotations and heatmap body.</li>
</ul>
<p>Other parameters:</p>
<ul>
<li><code>fast_hclust</code>: whether use <code>fastcluster::hclust()</code> to speed up clustering?</li>
<li><code>show_parent_dend_line</code>: when heatmap is split, whether to add a dashed line to mark parent dendrogram and children dendrograms?</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">ht_opt</span>(heatmap_column_names_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontface <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;italic&#34;</span>), 
       heatmap_column_title_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>),
       legend_border <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>,
       heatmap_border <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>,
       annotation_border <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>
)
ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ht1&#34;</span>, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Heatmap 1&#34;</span>,
              top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>))
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ht2&#34;</span>, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Heatmap 2&#34;</span>,
              top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(bar <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>))
ht1 <span style="color:#f92672">+</span> ht2
<span style="color:#a6e22e">ht_opt</span>(RESET <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>) <span style="color:#75715e"># 重置为默认配置</span>
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/yzvJs9nGhRboZVk.png" alt="ComplexHeatmap-3.18.png"></p>
<h3 id="313-adjust-blank-space-caused-by-annotations">3.13 Adjust blank space caused by annotations</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">m <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>)
ht <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(m, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>,
             top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>)),
             show_row_dend <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
<span style="color:#a6e22e">draw</span>(ht, row_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;fooooooooooo&#34;</span>, adjust_annotation_extension <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>,  <span style="color:#75715e"># default</span>
     column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;adjust_annotation_extension = TRUE&#34;</span>)
<span style="color:#a6e22e">draw</span>(ht, row_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;fooooooooooo&#34;</span>, adjust_annotation_extension <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>,
     column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;adjust_annotation_extension = FALSE&#34;</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/G6e4itowZdvx92X.png" alt="ComplexHeatmap-3.19.png"></p>
<h3 id="314-manually-increase-space-around-the-plot">3.14 Manually increase space around the plot</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">m2 <span style="color:#f92672">=</span> m
<span style="color:#a6e22e">rownames</span>(m2) <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;R&#34;</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>)
<span style="color:#a6e22e">rownames</span>(m2)[1] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;a long long long long long row name&#34;</span>
ht <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(m2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, row_names_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>, show_row_dend <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
<span style="color:#a6e22e">draw</span>(ht, padding <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>), <span style="color:#e6db74">&#34;mm&#34;</span>)) <span style="color:#75715e">## see right heatmap in following</span>
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/J6KpsUlTmHz4qjE.png" alt="ComplexHeatmap-3.20.png"></p>
<h2 id="4-legends">4 Legends</h2>
<h3 id="41-continuous-legends">4.1 Continuous legends</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">rm</span>(list <span style="color:#f92672">=</span> <span style="color:#a6e22e">ls</span>())
<span style="color:#a6e22e">library</span>(ComplexHeatmap)

col_fun <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">1</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;blue&#34;</span>, <span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>))
lgd <span style="color:#f92672">=</span> <span style="color:#a6e22e">Legend</span>(col_fun <span style="color:#f92672">=</span> col_fun, title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;foo&#34;</span>)
<span style="color:#a6e22e">draw</span>(lgd)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/ZlUHfBoGFJyI4De.png" alt="ComplexHeatmap-4.1.png"></p>
<p>需要单独画图例的时候，可以利用 draw() 来调节图例的位置。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">pushViewport</span>(<span style="color:#a6e22e">viewport</span>(width <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.9</span>, height <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.9</span>))
<span style="color:#a6e22e">grid.rect</span>()  <span style="color:#75715e"># border</span>
<span style="color:#a6e22e">draw</span>(lgd, x <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), y <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), just <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;left&#34;</span>, <span style="color:#e6db74">&#34;bottom&#34;</span>))
<span style="color:#a6e22e">draw</span>(lgd, x <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">0.5</span>, <span style="color:#e6db74">&#34;npc&#34;</span>), y <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">0.5</span>, <span style="color:#e6db74">&#34;npc&#34;</span>))
<span style="color:#a6e22e">draw</span>(lgd, x <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;npc&#34;</span>), y <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;npc&#34;</span>), just <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;right&#34;</span>, <span style="color:#e6db74">&#34;top&#34;</span>))
<span style="color:#a6e22e">popViewport</span>()
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/FO6QU1P7LBkKqDb.png" alt="ComplexHeatmap-4.2.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), 
        heatmap_legend_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(
          title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;rnorm&#34;</span>, <span style="color:#75715e"># 标题</span>
          title_position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;topleft&#34;</span>, <span style="color:#75715e"># 标题位置（topleft, topcenter, leftcenter-rot and lefttop-rot are only for vertical legend and leftcenter, lefttop are only for horizontal legend.）</span>
          legend_height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">6</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), <span style="color:#75715e">#t图例主体高度</span>
          grid_width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), <span style="color:#75715e"># 宽度</span>
          <span style="color:#75715e"># legend_width = unit(1, &#34;cm&#34;), # 宽度,作用于连续的水平图例</span>
          labels_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>, font <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>), <span style="color:#75715e"># label的颜色及大小</span>
          border <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>, <span style="color:#75715e"># 边框颜色</span>
          at <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-2</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>),  <span style="color:#75715e"># Break values of the legend</span>
          labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;neg_two&#34;</span>, <span style="color:#e6db74">&#34;zero&#34;</span>, <span style="color:#e6db74">&#34;pos_two&#34;</span>),<span style="color:#75715e"># Labels corresponding to break values</span>
          labels_rot <span style="color:#f92672">=</span> <span style="color:#ae81ff">180</span>),
        top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(
          foo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>,
          annotation_legend_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;foo_top_anno&#34;</span>))))
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/cMskoRY2DBajrdG.png" alt="ComplexHeatmap-4.3.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># 支持数学表达式</span>
lgd <span style="color:#f92672">=</span> <span style="color:#a6e22e">Legend</span>(col_fun <span style="color:#f92672">=</span> col_fun, title <span style="color:#f92672">=</span> <span style="color:#a6e22e">expression</span>(<span style="color:#a6e22e">hat</span>(beta) <span style="color:#f92672">==</span> (X^t <span style="color:#f92672">*</span> X)^{<span style="color:#ae81ff">-1</span>} <span style="color:#f92672">*</span> X^t <span style="color:#f92672">*</span> y), 
             at <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.25</span>, <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.75</span>, <span style="color:#ae81ff">1</span>), labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">expression</span>(alpha, beta, gamma, delta, epsilon))
<span style="color:#a6e22e">draw</span>(lgd)

<span style="color:#75715e"># 水平图例（大部分参数同上）</span>
lgd <span style="color:#f92672">=</span> <span style="color:#a6e22e">Legend</span>(col_fun <span style="color:#f92672">=</span> col_fun, title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;foo&#34;</span>, at <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.25</span>, <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.75</span>, <span style="color:#ae81ff">1</span>), 
             title_gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), <span style="color:#75715e"># 标题和主体的间隔</span>
             title_position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;topcenter&#34;</span>,
             direction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;horizontal&#34;</span>, <span style="color:#75715e"># 设置为水平(&#34;vertical&#34;, &#34;horizontal&#34;)</span>
             labels_rot <span style="color:#f92672">=</span> <span style="color:#ae81ff">45</span>)
<span style="color:#a6e22e">draw</span>(lgd)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/t5FbZeJVy23dUGW.png" alt="ComplexHeatmap-4.4.png"></p>
<h3 id="42-discrete-legends">4.2 Discrete legends</h3>
<p>与连续型图例参数类似，直接看下面代码。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">lgd <span style="color:#f92672">=</span> <span style="color:#a6e22e">Legend</span>(at <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>, 
             direction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;vertical&#34;</span>,
             title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;foo&#34;</span>, 
             title_position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;topleft&#34;</span>,
             labels <span style="color:#f92672">=</span> month.name[1<span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>],
             grid_height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), <span style="color:#75715e"># 区别于前面的legend_height</span>
             grid_width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#34;mm&#34;</span>),
             border <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>,
             legend_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>),
             labels_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>, fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">14</span>),
             title_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>, 
                             fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">14</span>))
<span style="color:#a6e22e">draw</span>(lgd)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/csaAdtfiPpKq8LJ.png" alt="ComplexHeatmap-4.5.png"></p>
<p>图例太多的话，可以使用 <code>ncol/nrow</code> 来分组。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">lgd <span style="color:#f92672">=</span> <span style="color:#a6e22e">Legend</span>(labels <span style="color:#f92672">=</span> month.name[1<span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>], legend_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>), title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;foo&#34;</span>,  title_position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;topcenter&#34;</span>, 
             gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), <span style="color:#75715e"># 设置间隔大小</span>
             ncol <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)
<span style="color:#a6e22e">draw</span>(lgd)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/q3mFlBv9OEXZNL6.png" alt="ComplexHeatmap-4.6.png"></p>
<p><code>ncol/nrow</code> 默认按行排序，按列排序需要使用 <code>by_row</code>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">lgd <span style="color:#f92672">=</span> <span style="color:#a6e22e">Legend</span>(labels <span style="color:#f92672">=</span> month.name[1<span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>], legend_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>), title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;foo&#34;</span>,  title_position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;topcenter&#34;</span>, 
             ncol <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>,
             by_row <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#a6e22e">draw</span>(lgd)

lgd <span style="color:#f92672">=</span> <span style="color:#a6e22e">Legend</span>(labels <span style="color:#f92672">=</span> month.name[1<span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>], legend_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>), title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;foo&#34;</span>,  title_position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;topcenter&#34;</span>, 
             nrow <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>,
             by_row <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#a6e22e">draw</span>(lgd)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/VvEHy7ftURrP4gK.png" alt="ComplexHeatmap-4.7.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># 使用 points 图例</span>
lgd <span style="color:#f92672">=</span> <span style="color:#a6e22e">Legend</span>(labels <span style="color:#f92672">=</span> month.name[1<span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>], title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;foo1&#34;</span>, 
             type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;points&#34;</span>, 
             pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>, <span style="color:#75715e"># 数字表示不同的形状</span>
             border <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>, legend_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>), background <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>)
<span style="color:#a6e22e">draw</span>(lgd)

lgd <span style="color:#f92672">=</span> <span style="color:#a6e22e">Legend</span>(labels <span style="color:#f92672">=</span> month.name[1<span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>], title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;foo1&#34;</span>, 
             type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;points&#34;</span>, 
             pch <span style="color:#f92672">=</span> <span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>],<span style="color:#75715e"># 传入字母</span>
             border <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>, legend_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>), background <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>)
<span style="color:#a6e22e">draw</span>(lgd)

<span style="color:#75715e"># 使用 lines 画图例</span>
lgd <span style="color:#f92672">=</span> <span style="color:#a6e22e">Legend</span>(labels <span style="color:#f92672">=</span> month.name[1<span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>], title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;foo3&#34;</span>, 
             type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;lines&#34;</span>, 
             legend_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>, 
                              lty <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>), <span style="color:#75715e"># 数字表示不同线的种类</span>
             grid_width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;cm&#34;</span>),
             border <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>, background <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>)
<span style="color:#a6e22e">draw</span>(lgd)

<span style="color:#75715e"># 使用 boxplot 画图例</span>
lgd <span style="color:#f92672">=</span> <span style="color:#a6e22e">Legend</span>(labels <span style="color:#f92672">=</span> month.name[1<span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>], title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;foo4&#34;</span>, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;boxplot&#34;</span>,
             legend_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>))
<span style="color:#a6e22e">draw</span>(lgd)

</code></pre></div><p><img src="https://i.loli.net/2020/05/13/g9dhRUpmEqZInVr.png" alt="ComplexHeatmap-4.8.png"></p>
<h3 id="43-a-list-of-legends">4.3 A list of legends</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">lgd1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Legend</span>(at <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>, legend_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>), title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;legend1&#34;</span>)
lgd2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Legend</span>(col_fun <span style="color:#f92672">=</span> col_fun, title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;legend2&#34;</span>, at <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.25</span>, <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.75</span>, <span style="color:#ae81ff">1</span>))
lgd3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Legend</span>(labels <span style="color:#f92672">=</span> month.name[1<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], legend_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>), title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;legend3&#34;</span>)

<span style="color:#75715e"># 下面两种写法效果一样</span>
pd <span style="color:#f92672">=</span> <span style="color:#a6e22e">packLegend</span>(lgd1, lgd2, lgd3)
pd <span style="color:#f92672">=</span> <span style="color:#a6e22e">packLegend</span>(list <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(lgd1, lgd2, lgd3))
<span style="color:#a6e22e">draw</span>(pd)


pd <span style="color:#f92672">=</span> <span style="color:#a6e22e">packLegend</span>(lgd1, lgd3, lgd2, lgd3, lgd2, lgd1, 
                direction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;vertical&#34;</span>, <span style="color:#75715e"># &#34;vertical&#34;, &#34;horizontal&#34;</span>
                max_height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), <span style="color:#75715e"># 整个图例的最大高度</span>
                column_gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)) <span style="color:#75715e"># 列间隔</span>
<span style="color:#a6e22e">draw</span>(pd)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/OP8NG7dzyY1Vvwg.png" alt="ComplexHeatmap-4.9.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">lgd1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Legend</span>(at <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>, legend_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>), title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;legend1&#34;</span>,
              nr <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
lgd2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Legend</span>(col_fun <span style="color:#f92672">=</span> col_fun, title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;legend2&#34;</span>, at <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.25</span>, <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.75</span>, <span style="color:#ae81ff">1</span>),
              direction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;horizontal&#34;</span>)

pd <span style="color:#f92672">=</span> <span style="color:#a6e22e">packLegend</span>(lgd1, lgd2, lgd3, lgd1, lgd2, lgd3, 
                direction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;horizontal&#34;</span>, column_gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">5</span>, <span style="color:#e6db74">&#34;mm&#34;</span>), 
                max_width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), <span style="color:#75715e"># 整个图例的最大宽度</span>
                row_gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)) <span style="color:#75715e"># 行间隔</span>
<span style="color:#a6e22e">draw</span>(pd)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/xPW8pO49DI52ubo.png" alt="ComplexHeatmap-4.10.png"></p>
<h3 id="44-heatmap-and-annotation-legends">4.4 Heatmap and annotation legends</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># 热图的图例（heatmap_legend_param），参数和上面基本一致。</span>
m <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>)
<span style="color:#a6e22e">Heatmap</span>(m, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, 
        heatmap_legend_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(
          at <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-2</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>),
          labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;low&#34;</span>, <span style="color:#e6db74">&#34;zero&#34;</span>, <span style="color:#e6db74">&#34;high&#34;</span>),
          title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Some values&#34;</span>,
          legend_height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;cm&#34;</span>),
          title_position <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;lefttop-rot&#34;</span>
        ))

<span style="color:#75715e"># 注释的图例（annotation_legend_param），参数和上面基本一致</span>
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>), 
                       bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;f&#34;</span>, <span style="color:#e6db74">&#34;m&#34;</span>), <span style="color:#ae81ff">10</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
                       annotation_legend_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(
                         foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(
                           title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Fooooooh&#34;</span>,
                           at <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">1</span>),
                           labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;zero&#34;</span>, <span style="color:#e6db74">&#34;median&#34;</span>, <span style="color:#e6db74">&#34;one&#34;</span>)
                         ),
                         bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(
                           title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Baaaaaaar&#34;</span>,
                           at <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;f&#34;</span>, <span style="color:#e6db74">&#34;m&#34;</span>),
                           labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;Female&#34;</span>, <span style="color:#e6db74">&#34;Male&#34;</span>)
                         )
                       ))
<span style="color:#a6e22e">Heatmap</span>(m, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/12znKjU8bpygcqB.png" alt="ComplexHeatmap-4.11.png"></p>
<p>下面给出大量的例子以供体会。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ha1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>), bar1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;f&#34;</span>, <span style="color:#e6db74">&#34;m&#34;</span>), <span style="color:#ae81ff">10</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>))
ha2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>), bar2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;f&#34;</span>, <span style="color:#e6db74">&#34;m&#34;</span>), <span style="color:#ae81ff">10</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>))
<span style="color:#a6e22e">Heatmap</span>(m, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha1) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">rowAnnotation</span>(sth <span style="color:#f92672">=</span> <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">Heatmap</span>(m, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha2)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/Qv84L7JFKCdnzUN.png" alt="ComplexHeatmap-4.12.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ha1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>), bar1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;f&#34;</span>, <span style="color:#e6db74">&#34;m&#34;</span>), <span style="color:#ae81ff">10</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>), 
                        annotation_name_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>)
ha2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>), bar2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;f&#34;</span>, <span style="color:#e6db74">&#34;m&#34;</span>), <span style="color:#ae81ff">10</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>))
<span style="color:#a6e22e">Heatmap</span>(m, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha1) <span style="color:#f92672">%v%</span>
  <span style="color:#a6e22e">Heatmap</span>(m, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha2, 
          right_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(sth <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>))
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/Gx3JDRLviQob57M.png" alt="ComplexHeatmap-4.13.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>), 
                       bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;f&#34;</span>, <span style="color:#e6db74">&#34;m&#34;</span>), <span style="color:#ae81ff">10</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
                       show_legend <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#66d9ef">TRUE</span>, <span style="color:#66d9ef">FALSE</span>), <span style="color:#75715e"># it can also be show_legend = c(bar = FALSE)</span>
                       annotation_name_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>)
<span style="color:#a6e22e">Heatmap</span>(m, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">Heatmap</span>(m, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, show_heatmap_legend <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/GH3YymcrdjLlkWp.png" alt="ComplexHeatmap-4.14.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ha1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>), 
                        bar1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;f&#34;</span>, <span style="color:#e6db74">&#34;m&#34;</span>), <span style="color:#ae81ff">10</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>))
ha2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>), 
                    bar2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], <span style="color:#ae81ff">10</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>))
ha3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(foo3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>), 
                    bar3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(month.name[1<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], <span style="color:#ae81ff">10</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>))
ht_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(m, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha1) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">Heatmap</span>(m, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, left_annotation <span style="color:#f92672">=</span> ha2) <span style="color:#f92672">+</span> 
  ha3
<span style="color:#a6e22e">draw</span>(ht_list, merge_legend <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/JUeNSwovG84Hjpu.png" alt="ComplexHeatmap-4.15.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">Heatmap</span>(m, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, heatmap_legend_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(color_bar <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;discrete&#34;</span>),
        top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>,
                                           annotation_legend_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(
                                             foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(color_bar <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;discrete&#34;</span>))))
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/M6nvcuAkopLH4CJ.png" alt="ComplexHeatmap-4.16.png"></p>
<h3 id="45-add-customized-legends">4.5 Add customized legends</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ha1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(pt <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>, each <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>)), 
                                         height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)), 
                        show_annotation_name <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#75715e"># 不显示注释名</span>
ha2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(ln <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_lines</span>(<span style="color:#a6e22e">cbind</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>), gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span>, lty <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>),
                                        height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)), 
                        show_annotation_name <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
m <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>)
<span style="color:#75715e"># 注释、热图及其图例</span>
ht_list <span style="color:#f92672">=</span> 
  <span style="color:#a6e22e">Heatmap</span>(m, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha1) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">Heatmap</span>(m, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha2) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">Heatmap</span>(m[, <span style="color:#ae81ff">1</span>], name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat3&#34;</span>, 
          top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(
            summary <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_summary</span>(gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>))
          ), width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))
<span style="color:#75715e"># 增加注释的图例</span>
lgd_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(
  <span style="color:#a6e22e">Legend</span>(labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;red&#34;</span>, <span style="color:#e6db74">&#34;green&#34;</span>), title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;pt&#34;</span>, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;points&#34;</span>, pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>, 
         legend_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>)),
  <span style="color:#a6e22e">Legend</span>(labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;darkblue&#34;</span>, <span style="color:#e6db74">&#34;lightblue&#34;</span>), title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ln&#34;</span>, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;lines&#34;</span>, 
         legend_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span>, lty <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>)),
  <span style="color:#a6e22e">Legend</span>(labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;group1&#34;</span>, <span style="color:#e6db74">&#34;group2&#34;</span>), title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;km&#34;</span>, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;boxplot&#34;</span>,
         legend_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>))
)
<span style="color:#a6e22e">draw</span>(ht_list, ht_gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">7</span>, <span style="color:#e6db74">&#34;mm&#34;</span>), row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, annotation_legend_list <span style="color:#f92672">=</span> lgd_list)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/t9kSLJqGze4MBw8.png" alt="ComplexHeatmap-4.17.png"></p>
<h3 id="46-the-side-of-legends">4.6 The side of legends</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ha1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>), bar1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;f&#34;</span>, <span style="color:#e6db74">&#34;m&#34;</span>), <span style="color:#ae81ff">10</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
                        annotation_legend_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(
                          foo1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(direction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;horizontal&#34;</span>),
                          bar1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(nrow <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)))
ha2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>), bar2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;f&#34;</span>, <span style="color:#e6db74">&#34;m&#34;</span>), <span style="color:#ae81ff">10</span>, replace <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>),
                        annotation_legend_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(
                          foo2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(direction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;horizontal&#34;</span>),
                          bar2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(nrow <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)))
ht_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(m, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat1&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha1, 
                  heatmap_legend_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(direction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;horizontal&#34;</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">rowAnnotation</span>(sth <span style="color:#f92672">=</span> <span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span>), 
                annotation_legend_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(sth <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(direction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;horizontal&#34;</span>))) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">Heatmap</span>(m, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat2&#34;</span>, top_annotation <span style="color:#f92672">=</span> ha2,
          heatmap_legend_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(direction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;horizontal&#34;</span>))
<span style="color:#a6e22e">draw</span>(ht_list, 
     merge_legend <span style="color:#f92672">=</span> T, 
     heatmap_legend_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>, 
     annotation_legend_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/Q2RgryjXJ5EDhps.png" alt="ComplexHeatmap-4.18.png"></p>
<h2 id="5-heatmap-decoration">5 Heatmap Decoration</h2>
<p>　　顾名思义，本节主要介绍热图的装饰美化，下图红框部分都是可进行操作的部分。</p>
<p><img src="https://i.loli.net/2020/05/13/HdByjiTKDLAFJfq.png" alt="ComplexHeatmap-5.0.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">123</span>)
mat <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">80</span>, <span style="color:#ae81ff">2</span>), <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">10</span>)
mat <span style="color:#f92672">=</span> <span style="color:#a6e22e">rbind</span>(mat, <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">40</span>, <span style="color:#ae81ff">-2</span>), <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">10</span>))
<span style="color:#a6e22e">rownames</span>(mat) <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;R&#34;</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">12</span>)
<span style="color:#a6e22e">colnames</span>(mat) <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;C&#34;</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>)

ha_column1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(points <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">10</span>)), 
                               annotation_name_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>)
ht1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ht1&#34;</span>, km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Heatmap 1&#34;</span>, 
              top_annotation <span style="color:#f92672">=</span> ha_column1, row_names_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>)

ha_column2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(type <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#a6e22e">rep</span>(<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#ae81ff">5</span>), <span style="color:#a6e22e">rep</span>(<span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#ae81ff">5</span>)),
                               col <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(type <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;a&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blue&#34;</span>)))
ht2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ht2&#34;</span>, row_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Heatmap 2&#34;</span>, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Heatmap 2&#34;</span>,
              bottom_annotation <span style="color:#f92672">=</span> ha_column2, column_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)

ht_list <span style="color:#f92672">=</span> ht1 <span style="color:#f92672">+</span> ht2 <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">rowAnnotation</span>(bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#a6e22e">rowMeans</span>(mat), width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)))
<span style="color:#a6e22e">draw</span>(ht_list, row_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Heatmap list&#34;</span>, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Heatmap list&#34;</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/slTzq4ZG7d86tbc.png" alt="ComplexHeatmap-5.1.png"></p>
<h3 id="51-decoration-functions">5.1 Decoration functions</h3>
<p>There are following decoration functions.</p>
<ul>
<li><code>decorate_heatmap_body()</code></li>
<li><code>decorate_annotation()</code></li>
<li><code>decorate_dend()</code></li>
<li><code>decorate_title()</code></li>
<li><code>decorate_dimnames()</code></li>
<li><code>decorate_row_names()</code>, identical to decorate_dimnames(&hellip;, which = &ldquo;row&rdquo;).</li>
<li><code>decorate_column_names()</code>, identical to decorate_dimnames(&hellip;, which = &ldquo;column&rdquo;).</li>
<li><code>decorate_row_dend()</code>, identical to decorate_dend(&hellip;, which = &ldquo;row&rdquo;).</li>
<li><code>decorate_column_dend()</code>, identical to decorate_dend(&hellip;, which = &ldquo;column&rdquo;).</li>
<li><code>decorate_row_title()</code>, identical to decorate_title(&hellip;, which = &ldquo;row&rdquo;).</li>
<li><code>decorate_column_title()</code>, identical to decorate_title(&hellip;, which = &ldquo;column&rdquo;).</li>
</ul>
<p>依次运行下面代码查看就可以知道每个代码的作用。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ht_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">draw</span>(ht_list, row_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Heatmap list&#34;</span>, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Heatmap list&#34;</span>, 
               heatmap_legend_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;right&#34;</span>, annotation_legend_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>)

<span style="color:#a6e22e">decorate_heatmap_body</span>(<span style="color:#e6db74">&#34;ht1&#34;</span>, {
  <span style="color:#a6e22e">grid.text</span>(<span style="color:#e6db74">&#34;outlier&#34;</span>, <span style="color:#ae81ff">1.5</span><span style="color:#f92672">/</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">2.5</span><span style="color:#f92672">/</span><span style="color:#ae81ff">4</span>, default.units <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;npc&#34;</span>)
  <span style="color:#a6e22e">grid.lines</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.5</span>), <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>), gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(lty <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>))
}, slice <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)

<span style="color:#a6e22e">decorate_column_dend</span>(<span style="color:#e6db74">&#34;ht1&#34;</span>, {
  tree <span style="color:#f92672">=</span> <span style="color:#a6e22e">column_dend</span>(ht_list)<span style="color:#f92672">$</span>ht1[[1]]
  ind <span style="color:#f92672">=</span> <span style="color:#a6e22e">cutree</span>(<span style="color:#a6e22e">as.hclust</span>(tree), k <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)<span style="color:#a6e22e">[order.dendrogram</span>(tree)]
  
  first_index <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(l) <span style="color:#a6e22e">which</span>(l)[1]
  last_index <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(l) { x <span style="color:#f92672">=</span> <span style="color:#a6e22e">which</span>(l); x<span style="color:#a6e22e">[length</span>(x)] }
  x1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#a6e22e">first_index</span>(ind <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>), <span style="color:#a6e22e">first_index</span>(ind <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>)) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
  x2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#a6e22e">last_index</span>(ind <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>), <span style="color:#a6e22e">last_index</span>(ind <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>))
  <span style="color:#a6e22e">grid.rect</span>(x <span style="color:#f92672">=</span> x1<span style="color:#f92672">/</span><span style="color:#a6e22e">length</span>(ind), width <span style="color:#f92672">=</span> (x2 <span style="color:#f92672">-</span> x1)<span style="color:#f92672">/</span><span style="color:#a6e22e">length</span>(ind), just <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>,
            default.units <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;npc&#34;</span>, gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;#FF000040&#34;</span>, <span style="color:#e6db74">&#34;#00FF0040&#34;</span>), col <span style="color:#f92672">=</span> <span style="color:#66d9ef">NA</span>))
})

<span style="color:#a6e22e">decorate_row_names</span>(<span style="color:#e6db74">&#34;ht1&#34;</span>, {
  <span style="color:#a6e22e">grid.rect</span>(gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#FF000040&#34;</span>))
}, slice <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)

<span style="color:#a6e22e">decorate_row_title</span>(<span style="color:#e6db74">&#34;ht1&#34;</span>, {
  <span style="color:#a6e22e">grid.rect</span>(gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#00FF0040&#34;</span>))
}, slice <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)

<span style="color:#a6e22e">decorate_annotation</span>(<span style="color:#e6db74">&#34;points&#34;</span>, {
  <span style="color:#a6e22e">grid.lines</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>), <span style="color:#a6e22e">unit</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>), <span style="color:#e6db74">&#34;native&#34;</span>), gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>))
})
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/bmL1G9usiPqekER.png" alt="ComplexHeatmap-5.2.png"></p>
<h3 id="52-examples">5.2 Examples</h3>
<p>Barplot for single-column heatmap.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># DMRs</span>
bed <span style="color:#f92672">=</span> <span style="color:#a6e22e">generateRandomBed</span>(nr <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>)
<span style="color:#75715e"># fractions</span>
frac <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">400</span>, min <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.4</span>, max <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>), <span style="color:#a6e22e">runif</span>(<span style="color:#a6e22e">nrow</span>(bed) <span style="color:#f92672">-</span> <span style="color:#ae81ff">400</span>, min <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.2</span>, max <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.6</span>))
col_fun <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;orange&#34;</span>))
<span style="color:#75715e"># two groups</span>
split <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#a6e22e">rep</span>(<span style="color:#e6db74">&#34;group1&#34;</span>, <span style="color:#ae81ff">400</span>), <span style="color:#a6e22e">rep</span>(<span style="color:#e6db74">&#34;group2&#34;</span>, <span style="color:#a6e22e">nrow</span>(bed) <span style="color:#f92672">-</span> <span style="color:#ae81ff">400</span>))
<span style="color:#75715e"># draw the fraction heatmap with an empty annotation</span>
ht <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(frac, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;fraction&#34;</span>, col <span style="color:#f92672">=</span> col_fun, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>),
             top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(barplot <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_empty</span>(height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))))
ht <span style="color:#f92672">=</span> <span style="color:#a6e22e">draw</span>(ht, row_split <span style="color:#f92672">=</span> split)
<span style="color:#75715e"># get the row indices in the two row-groups</span>
ro <span style="color:#f92672">=</span> <span style="color:#a6e22e">row_order</span>(ht)
w <span style="color:#f92672">=</span> bed[, <span style="color:#ae81ff">3</span>] <span style="color:#f92672">-</span> bed[, <span style="color:#ae81ff">2</span>]
<span style="color:#75715e"># the mean weighted fraction in the two groups</span>
p <span style="color:#f92672">=</span> <span style="color:#a6e22e">sapply</span>(ro, <span style="color:#a6e22e">function</span>(index) {
  <span style="color:#a6e22e">sum</span>(w[index]<span style="color:#f92672">*</span>frac[index])<span style="color:#f92672">/</span><span style="color:#a6e22e">sum</span>(w[index])
})
<span style="color:#75715e"># add two bars of `p`</span>
<span style="color:#a6e22e">decorate_annotation</span>(<span style="color:#e6db74">&#34;barplot&#34;</span>, {
  <span style="color:#a6e22e">pushViewport</span>(<span style="color:#a6e22e">viewport</span>(xscale <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">2.5</span>), yscale <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">max</span>(p)<span style="color:#f92672">*</span><span style="color:#ae81ff">1.1</span>)))
  <span style="color:#a6e22e">grid.rect</span>(x <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, width <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.8</span>, height <span style="color:#f92672">=</span> p, just <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>,
            gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;orange&#34;</span>), default.units <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;native&#34;</span>)
  <span style="color:#a6e22e">grid.yaxis</span>()
  <span style="color:#a6e22e">grid.text</span>(<span style="color:#e6db74">&#34;mean fraction&#34;</span>, x <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">-1.5</span>, <span style="color:#e6db74">&#34;cm&#34;</span>),rot <span style="color:#f92672">=</span> <span style="color:#ae81ff">90</span>, just <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>)
  <span style="color:#a6e22e">popViewport</span>()
})
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/mfwIzjry3SBeUqv.png" alt="ComplexHeatmap-5.3.png"></p>
<p>Add titles for row annotations.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ht_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, show_column_dend <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">rowAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">rowAnnotation</span>(bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_boxplot</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), <span style="color:#ae81ff">10</span>)), width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))
<span style="color:#a6e22e">draw</span>(ht_list, padding <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">2</span>), <span style="color:#e6db74">&#34;mm&#34;</span>)) <span style="color:#75715e"># add space for titles</span>
<span style="color:#a6e22e">decorate_annotation</span>(<span style="color:#e6db74">&#34;foo&#34;</span>, { 
  <span style="color:#a6e22e">grid.text</span>(<span style="color:#e6db74">&#34;title for barplot&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;npc&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;mm&#34;</span>), just <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>) 
})
<span style="color:#a6e22e">decorate_annotation</span>(<span style="color:#e6db74">&#34;bar&#34;</span>, { 
  <span style="color:#a6e22e">grid.text</span>(<span style="color:#e6db74">&#34;title for boxplot&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;npc&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;mm&#34;</span>), just <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>) 
})
<span style="color:#a6e22e">decorate_heatmap_body</span>(<span style="color:#e6db74">&#34;mat&#34;</span>, {
  <span style="color:#a6e22e">grid.text</span>(<span style="color:#e6db74">&#34;title for the heatmap&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;npc&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;mm&#34;</span>), just <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>)
})
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/3j4lpPvT6yiNYqh.png" alt="ComplexHeatmap-5.4.png"></p>
<h2 id="6-upset-plot">6 UpSet plot</h2>
<h3 id="61-input-data">6.1 Input data</h3>
<p>准备好如下格式的数据。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">rm</span>(list <span style="color:#f92672">=</span> <span style="color:#a6e22e">ls</span>())
lt <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(set1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span>),
          set2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span>, <span style="color:#e6db74">&#34;d&#34;</span>, <span style="color:#e6db74">&#34;e&#34;</span>))
<span style="color:#a6e22e">list_to_matrix</span>(lt)
</code></pre></div><h3 id="62-mode">6.2 Mode</h3>
<p>　　共有如下三种模式，三种模式的差别如下图所示。</p>
<ul>
<li>distinct mode</li>
<li>intersect mode</li>
<li>union mode</li>
</ul>
<p><img src="https://i.loli.net/2020/05/13/cxYvMdPW7qtZEIm.png" alt="ComplexHeatmap-6.0.png"></p>
<h3 id="63-make-the-combination-matrix">6.3 Make the combination matrix</h3>
<p>数据准备</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">123</span>)
lt <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(a <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>, <span style="color:#ae81ff">5</span>),
          b <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>, <span style="color:#ae81ff">10</span>),
          c <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>, <span style="color:#ae81ff">15</span>))
</code></pre></div><p><code>make_comb_mat</code> 生产比较矩阵</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">m1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">make_comb_mat</span>(lt)
m2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">make_comb_mat</span>(a <span style="color:#f92672">=</span> lt<span style="color:#f92672">$</span>a, b <span style="color:#f92672">=</span> lt<span style="color:#f92672">$</span>b, c <span style="color:#f92672">=</span> lt<span style="color:#f92672">$</span>c)
m3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">make_comb_mat</span>(<span style="color:#a6e22e">list_to_matrix</span>(lt))
</code></pre></div><p>选择不同的模式，在此可以观察三者之间的差别。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">m1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">make_comb_mat</span>(lt) <span style="color:#75715e"># the default mode is `distinct`</span>
m2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">make_comb_mat</span>(lt, mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;intersect&#34;</span>)
m3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">make_comb_mat</span>(lt, mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;union&#34;</span>)
</code></pre></div><p>也可以对数据利用不同的条件过滤</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">m1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">make_comb_mat</span>(lt, min_set_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>) <span style="color:#75715e"># 去除数据少于7的set</span>
m2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">make_comb_mat</span>(lt, top_n_sets <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>) <span style="color:#75715e"># 保留set最大的前2个</span>
m3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">make_comb_mat</span>(lt, universal_set <span style="color:#f92672">=</span> <span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>]) <span style="color:#75715e"># 所有set中只保留前10个字母的元素</span>
m4 <span style="color:#f92672">=</span> <span style="color:#a6e22e">make_comb_mat</span>(lt, complement_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>) <span style="color:#75715e"># 所有集合的补集的大小</span>
</code></pre></div><h3 id="64-utility-functions">6.4 Utility functions</h3>
<p>实用小工具环节，知道有这些函数即可，具体有啥用处，后面都会举例说明。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">m <span style="color:#f92672">=</span> <span style="color:#a6e22e">make_comb_mat</span>(lt)
<span style="color:#a6e22e">set_name</span>(m) <span style="color:#75715e"># 集合名</span>
<span style="color:#a6e22e">comb_name</span>(m) <span style="color:#75715e"># 组合的集合名</span>
<span style="color:#a6e22e">set_size</span>(m)
<span style="color:#a6e22e">comb_size</span>(m)
<span style="color:#a6e22e">comb_degree</span>(m) <span style="color:#75715e"># 组合中包含的及集合数</span>
<span style="color:#a6e22e">extract_comb</span>(m, <span style="color:#e6db74">&#34;101&#34;</span>) <span style="color:#75715e"># 提取指定组合里面的元素</span>
</code></pre></div><p>　　用基因组的例子解释 <code>extract_comb</code> 的作用，在数据过大时就可以用这些函数来进行提取查看等一系列必须的操作。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">library</span>(circlize)
<span style="color:#a6e22e">library</span>(GenomicRanges)
lt2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">lapply</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>, <span style="color:#a6e22e">function</span>(i) <span style="color:#a6e22e">generateRandomBed</span>())
lt2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">lapply</span>(lt2, <span style="color:#a6e22e">function</span>(df) <span style="color:#a6e22e">GRanges</span>(seqnames <span style="color:#f92672">=</span> df[, <span style="color:#ae81ff">1</span>], 
                                       ranges <span style="color:#f92672">=</span> <span style="color:#a6e22e">IRanges</span>(df[, <span style="color:#ae81ff">2</span>], df[, <span style="color:#ae81ff">3</span>])))
<span style="color:#a6e22e">names</span>(lt2) <span style="color:#f92672">=</span> <span style="color:#66d9ef">letters</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>]
m <span style="color:#f92672">=</span> <span style="color:#a6e22e">make_comb_mat</span>(lt2)
<span style="color:#a6e22e">set_size</span>(m)
<span style="color:#a6e22e">comb_size</span>(m)
<span style="color:#a6e22e">extract_comb</span>(m, <span style="color:#e6db74">&#34;1010&#34;</span>)
</code></pre></div><h3 id="65-make-the-plot">6.5 Make the plot</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">m <span style="color:#f92672">=</span> <span style="color:#a6e22e">make_comb_mat</span>(lt)
<span style="color:#a6e22e">UpSet</span>(m) <span style="color:#75715e"># 默认</span>

<span style="color:#75715e"># 一些参数设置</span>
<span style="color:#a6e22e">UpSet</span>(m, 
      pt_size <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">5</span>, <span style="color:#e6db74">&#34;mm&#34;</span>), <span style="color:#75715e"># 点大小</span>
      set_order <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span>),  <span style="color:#75715e"># 集合排序</span>
      comb_order <span style="color:#f92672">=</span> <span style="color:#a6e22e">order</span>(<span style="color:#a6e22e">comb_size</span>(m)), <span style="color:#75715e"># 组合排序</span>
      comb_col <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;red&#34;</span>, <span style="color:#e6db74">&#34;blue&#34;</span>, <span style="color:#e6db74">&#34;black&#34;</span>)<span style="color:#a6e22e">[comb_degree</span>(m)], <span style="color:#75715e"># 组合颜色</span>
      bg_pt_col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#75715e">#不在组合中的点颜色</span>
      bg_col <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;#F0F0FF&#34;</span>, <span style="color:#e6db74">&#34;#FFF0F0&#34;</span>)) <span style="color:#75715e"># 背景颜色一个或两个</span>
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/LNufPHIGnQVXU9C.png" alt="ComplexHeatmap-6.1.png"></p>
<p>　　下面的代码本质都是对前面数据进行处理，可以更好的理解前面那些函数的功用，自行按需组合使用即可。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">UpSet</span>(<span style="color:#a6e22e">t</span>(m)) <span style="color:#75715e"># 转置图形</span>
<span style="color:#a6e22e">UpSet</span>(m<span style="color:#a6e22e">[comb_size</span>(m) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">4</span>])
<span style="color:#a6e22e">UpSet</span>(m<span style="color:#a6e22e">[comb_degree</span>(m) <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>])
m1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">make_comb_mat</span>(lt) <span style="color:#75715e"># the default mode is `distinct`</span>
m2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">make_comb_mat</span>(lt, mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;intersect&#34;</span>)
m3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">make_comb_mat</span>(lt, mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;union&#34;</span>)
<span style="color:#a6e22e">UpSet</span>(m1)
<span style="color:#a6e22e">UpSet</span>(m2)
<span style="color:#a6e22e">UpSet</span>(m3)
</code></pre></div><p>　　使用 <code>upset_top_annotation</code> 修改顶部注释，还可以使用 <code>upset_right_annotation</code> 修改右边的注释。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">UpSet</span>(m, comb_order <span style="color:#f92672">=</span> <span style="color:#a6e22e">order</span>(<span style="color:#a6e22e">comb_degree</span>(m)), 
      top_annotation <span style="color:#f92672">=</span>  
        <span style="color:#a6e22e">upset_top_annotation</span>(m, <span style="color:#75715e"># 修改顶部注释</span>
                             gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#a6e22e">comb_degree</span>(m), <span style="color:#75715e"># 按照comb_degree对边框着色</span>
                                       fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gray&#34;</span>), <span style="color:#75715e"># 填充色</span>
                             axis_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;right&#34;</span>, <span style="color:#75715e"># 坐标轴位置（&#39;left&#39;, &#39;right&#39;, &#39;top&#39; and &#39;bottom&#39;）</span>
                                               at <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">15</span>), <span style="color:#75715e"># 刻度</span>
                                               labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;zero&#34;</span>, <span style="color:#e6db74">&#34;five&#34;</span>, <span style="color:#e6db74">&#34;ten&#34;</span>, <span style="color:#e6db74">&#34;fifteen&#34;</span>)), <span style="color:#75715e"># 刻度标记</span>
                             annotation_name_rot <span style="color:#f92672">=</span> <span style="color:#ae81ff">90</span>, <span style="color:#75715e"># 注释名角度（0, 90, 180, 270）</span>
                             annotation_name_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;right&#34;</span>,
                             ylim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">15</span>), <span style="color:#75715e"># y轴范围</span>
                             bar_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>), <span style="color:#75715e"># 柱体宽度</span>
      ) 
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/gMEUhusQY6pfa2C.png" alt="ComplexHeatmap-6.3.png"></p>
<p>　　利用 <code>HeatmapAnnotation</code> 增加额外的注释，下面的代码就比较魔幻了，注意消化。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">UpSet</span>(m, top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(
  degree <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">comb_degree</span>(m)),
  <span style="color:#e6db74">&#34;Intersection\nsize1&#34;</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#a6e22e">comb_size</span>(m), 
                                      border <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, 
                                      gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>), 
                                      height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)
  ), 
  annotation_name_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>, 
  annotation_name_rot <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>))

<span style="color:#a6e22e">UpSet</span>(m, right_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(
  <span style="color:#e6db74">&#34;Set size2&#34;</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#a6e22e">set_size</span>(m), 
                            border <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, 
                            gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>), 
                            width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)
  ),
  group <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;group1&#34;</span>, <span style="color:#e6db74">&#34;group1&#34;</span>, <span style="color:#e6db74">&#34;group2&#34;</span>)))


<span style="color:#a6e22e">UpSet</span>(m, left_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(
  <span style="color:#e6db74">&#34;Set size3&#34;</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#a6e22e">set_size</span>(m), 
                            border <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, 
                            gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>), 
                            width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)
  )), right_annotation <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>)


<span style="color:#a6e22e">UpSet</span>(m, left_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(
  <span style="color:#e6db74">&#34;Set size4&#34;</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#a6e22e">set_size</span>(m), 
                            axis_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(direction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;reverse&#34;</span>),
                            border <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, 
                            gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>), 
                            width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)
  )), right_annotation <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>,
  row_names_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;right&#34;</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/bqwMtsNvZmDxj6C.png" alt="ComplexHeatmap-6.4.png"></p>
<p>当然也是可以和热图进行组合的。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">ht <span style="color:#f92672">=</span> <span style="color:#a6e22e">UpSet</span>(m)
ht <span style="color:#f92672">+</span> <span style="color:#a6e22e">Heatmap</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;foo&#34;</span>, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">5</span>, <span style="color:#e6db74">&#34;mm&#34;</span>)) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">rowAnnotation</span>(bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>))


ht <span style="color:#f92672">%v%</span> <span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">rbind</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">7</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;foo&#34;</span>, row_names_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>, 
               height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">5</span>, <span style="color:#e6db74">&#34;mm&#34;</span>)) <span style="color:#f92672">%v%</span> 
  <span style="color:#a6e22e">HeatmapAnnotation</span>(bar <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">7</span>),
                    annotation_name_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/OvEGDAzXulbeN5p.png" alt="ComplexHeatmap-6.5.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">m1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">make_comb_mat</span>(lt, mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;distinct&#34;</span>)
m2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">make_comb_mat</span>(lt, mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;intersect&#34;</span>)
m3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">make_comb_mat</span>(lt, mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;union&#34;</span>)
<span style="color:#a6e22e">UpSet</span>(m1, row_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;distinct mode&#34;</span>) <span style="color:#f92672">%v%</span>
  <span style="color:#a6e22e">UpSet</span>(m2, row_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;intersect mode&#34;</span>) <span style="color:#f92672">%v%</span>
  <span style="color:#a6e22e">UpSet</span>(m3, row_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;union mode&#34;</span>)

<span style="color:#75715e"># 利用 anno_lines 达到上图能够反应三组数据的结果</span>
ht <span style="color:#f92672">=</span> <span style="color:#a6e22e">UpSet</span>(m1, top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(size <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_lines</span>(
  <span style="color:#a6e22e">cbind</span>(<span style="color:#a6e22e">comb_size</span>(m1), <span style="color:#a6e22e">comb_size</span>(m2), <span style="color:#a6e22e">comb_size</span>(m3)),
  gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>), height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)
)))
<span style="color:#75715e"># you need to manually construct a legend</span>
<span style="color:#a6e22e">draw</span>(ht, annotation_legend_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(<span style="color:#a6e22e">Legend</span>(
  title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mode&#34;</span>,
  type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;lines&#34;</span>,
  labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;distinct&#34;</span>, <span style="color:#e6db74">&#34;intersect&#34;</span>, <span style="color:#e6db74">&#34;union&#34;</span>),
  legend_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>)
))
)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/nNVh25clAUWbiHE.png" alt="ComplexHeatmap-6.6.png"></p>
<h2 id="7-density-heatmap">7 Density heatmap</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">123</span>)
m <span style="color:#f92672">=</span> <span style="color:#a6e22e">cbind</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">10</span><span style="color:#f92672">*</span><span style="color:#ae81ff">100</span>), ncol <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>),
          <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">runif</span>(<span style="color:#ae81ff">10</span><span style="color:#f92672">*</span><span style="color:#ae81ff">100</span>, min <span style="color:#f92672">=</span> <span style="color:#ae81ff">-2</span>, max <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.5</span>, ncol <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>))
<span style="color:#a6e22e">colnames</span>(m) <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;C&#34;</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">ncol</span>(m))
<span style="color:#75715e"># 默认效果</span>
<span style="color:#a6e22e">densityHeatmap</span>(m)

<span style="color:#75715e"># 配置参数</span>
<span style="color:#a6e22e">densityHeatmap</span>(m, 
               col <span style="color:#f92672">=</span> <span style="color:#a6e22e">topo.colors</span>(<span style="color:#ae81ff">10</span>), <span style="color:#75715e"># 颜色</span>
               <span style="color:#75715e"># column_order = sample(20, 20), # 列重排序</span>
               cluster_columns <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, <span style="color:#75715e"># 列聚类</span>
               clustering_distance_columns <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ks&#34;</span>, <span style="color:#75715e">#列距离计算方法</span>
               title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Distribution as heatmap&#34;</span>, <span style="color:#75715e"># 标题</span>
               ylim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-2</span>, <span style="color:#ae81ff">2</span>), <span style="color:#75715e"># y轴范围</span>
               ylab <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;some values&#34;</span>) <span style="color:#75715e"># y轴标题</span>
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/QhYguLyztHlDmaN.png" alt="ComplexHeatmap-7.1.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#75715e"># 增加注释</span>
ha1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(dist <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#a6e22e">rep</span>(<span style="color:#e6db74">&#34;rnorm&#34;</span>, <span style="color:#ae81ff">10</span>), <span style="color:#a6e22e">rep</span>(<span style="color:#e6db74">&#34;runif&#34;</span>, <span style="color:#ae81ff">10</span>)))
ha2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">20</span>)))
<span style="color:#a6e22e">densityHeatmap</span>(m, top_annotation <span style="color:#f92672">=</span> ha1, bottom_annotation <span style="color:#f92672">=</span> ha2)

<span style="color:#75715e"># 与热图组合</span>
<span style="color:#a6e22e">densityHeatmap</span>(m) <span style="color:#f92672">%v%</span>
  <span style="color:#a6e22e">HeatmapAnnotation</span>(foo <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">20</span>)) <span style="color:#f92672">%v%</span>
  <span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">20</span><span style="color:#f92672">*</span><span style="color:#ae81ff">20</span>), ncol <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mat&#34;</span>, height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/3cSoZIneVC62dt5.png" alt="ComplexHeatmap-7.2.png"></p>
<h2 id="8-more-examples">8 More Examples</h2>
<h3 id="81-add-more-information-for-gene-expression-matrix">8.1 Add more information for gene expression matrix</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">rm</span>(list <span style="color:#f92672">=</span> <span style="color:#a6e22e">ls</span>())
<span style="color:#a6e22e">library</span>(ComplexHeatmap)
<span style="color:#a6e22e">library</span>(circlize)

expr <span style="color:#f92672">=</span> <span style="color:#a6e22e">readRDS</span>(<span style="color:#a6e22e">system.file</span>(package <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ComplexHeatmap&#34;</span>, <span style="color:#e6db74">&#34;extdata&#34;</span>, <span style="color:#e6db74">&#34;gene_expression.rds&#34;</span>))
mat <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.matrix</span>(expr[, <span style="color:#a6e22e">grep</span>(<span style="color:#e6db74">&#34;cell&#34;</span>, <span style="color:#a6e22e">colnames</span>(expr))])
base_mean <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowMeans</span>(mat)
mat_scaled <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>(<span style="color:#a6e22e">apply</span>(mat, <span style="color:#ae81ff">1</span>, scale))

type <span style="color:#f92672">=</span> <span style="color:#a6e22e">gsub</span>(<span style="color:#e6db74">&#34;s\\d+_&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">colnames</span>(mat))
ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(type <span style="color:#f92672">=</span> type, annotation_name_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>)

ht_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat_scaled, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;expression&#34;</span>, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>, 
                  col <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-2</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>)),
                  top_annotation <span style="color:#f92672">=</span> ha, 
                  show_column_names <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, row_title <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>, show_row_dend <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">Heatmap</span>(base_mean, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;base mean&#34;</span>, 
          top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(summary <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_summary</span>(gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>), 
                                                                    height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))),
          width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">15</span>, <span style="color:#e6db74">&#34;mm&#34;</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">rowAnnotation</span>(length <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_points</span>(expr<span style="color:#f92672">$</span>length, pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>, size <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;mm&#34;</span>), 
                                     axis_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(at <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2e5</span>, <span style="color:#ae81ff">4e5</span>, <span style="color:#ae81ff">6e5</span>), 
                                                       labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;0kb&#34;</span>, <span style="color:#e6db74">&#34;200kb&#34;</span>, <span style="color:#e6db74">&#34;400kb&#34;</span>, <span style="color:#e6db74">&#34;600kb&#34;</span>)),
                                     width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">Heatmap</span>(expr<span style="color:#f92672">$</span>type, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gene type&#34;</span>, 
          top_annotation <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(summary <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_summary</span>(height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>))),
          width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">15</span>, <span style="color:#e6db74">&#34;mm&#34;</span>))

ht_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(block <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_block</span>(gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>, col <span style="color:#f92672">=</span> <span style="color:#66d9ef">NA</span>)), 
                        width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;mm&#34;</span>)) <span style="color:#f92672">+</span> ht_list

<span style="color:#a6e22e">draw</span>(ht_list, ht_gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">5</span>, <span style="color:#e6db74">&#34;mm&#34;</span>))
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/BLw1JiGHTOaEx73.png" alt="ComplexHeatmap-8.1.png"></p>
<h3 id="82-the-measles-vaccine-heatmap">8.2 The measles vaccine heatmap</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">mat <span style="color:#f92672">=</span> <span style="color:#a6e22e">readRDS</span>(<span style="color:#a6e22e">system.file</span>(<span style="color:#e6db74">&#34;extdata&#34;</span>, <span style="color:#e6db74">&#34;measles.rds&#34;</span>, package <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ComplexHeatmap&#34;</span>))
ha1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(
  dist1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(
    <span style="color:#a6e22e">colSums</span>(mat), 
    bar_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, 
    gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>, fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#FFE200&#34;</span>), 
    border <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>,
    axis_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(at <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2e5</span>, <span style="color:#ae81ff">4e5</span>, <span style="color:#ae81ff">6e5</span>, <span style="color:#ae81ff">8e5</span>),
                      labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;0&#34;</span>, <span style="color:#e6db74">&#34;200k&#34;</span>, <span style="color:#e6db74">&#34;400k&#34;</span>, <span style="color:#e6db74">&#34;600k&#34;</span>, <span style="color:#e6db74">&#34;800k&#34;</span>)),
    height <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)
  ), show_annotation_name <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
ha2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowAnnotation</span>(
  dist2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_barplot</span>(
    <span style="color:#a6e22e">rowSums</span>(mat), 
    bar_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, 
    gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>, fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#FFE200&#34;</span>), 
    border <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>,
    axis_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(at <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5e5</span>, <span style="color:#ae81ff">1e6</span>, <span style="color:#ae81ff">1.5e6</span>),
                      labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;0&#34;</span>, <span style="color:#e6db74">&#34;500k&#34;</span>, <span style="color:#e6db74">&#34;1m&#34;</span>, <span style="color:#e6db74">&#34;1.5m&#34;</span>)),
    width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;cm&#34;</span>)
  ), show_annotation_name <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
year_text <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.numeric</span>(<span style="color:#a6e22e">colnames</span>(mat))
year_text[year_text <span style="color:#f92672">%%</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
ha_column <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(
  year <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_text</span>(year_text, rot <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, location <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;npc&#34;</span>), just <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;top&#34;</span>)
)
col_fun <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">800</span>, <span style="color:#ae81ff">1000</span>, <span style="color:#ae81ff">127000</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;cornflowerblue&#34;</span>, <span style="color:#e6db74">&#34;yellow&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>))
ht_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cases&#34;</span>, col <span style="color:#f92672">=</span> col_fun,
                  cluster_columns <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, show_row_dend <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, rect_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(col<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>), 
                  show_column_names <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>,
                  row_names_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>, row_names_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>),
                  column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Measles cases in US states 1930-2001\nVaccine introduced 1961&#39;</span>,
                  top_annotation <span style="color:#f92672">=</span> ha1, bottom_annotation <span style="color:#f92672">=</span> ha_column,
                  heatmap_legend_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(at <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5e4</span>, <span style="color:#ae81ff">1e5</span>, <span style="color:#ae81ff">1.5e5</span>), 
                                              labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;0&#34;</span>, <span style="color:#e6db74">&#34;50k&#34;</span>, <span style="color:#e6db74">&#34;100k&#34;</span>, <span style="color:#e6db74">&#34;150k&#34;</span>))) <span style="color:#f92672">+</span> ha2
<span style="color:#a6e22e">draw</span>(ht_list, ht_gap <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;mm&#34;</span>))
<span style="color:#a6e22e">decorate_heatmap_body</span>(<span style="color:#e6db74">&#34;cases&#34;</span>, {
  i <span style="color:#f92672">=</span> <span style="color:#a6e22e">which</span>(<span style="color:#a6e22e">colnames</span>(mat) <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;1961&#34;</span>)
  x <span style="color:#f92672">=</span> i<span style="color:#f92672">/</span><span style="color:#a6e22e">ncol</span>(mat)
  <span style="color:#a6e22e">grid.lines</span>(<span style="color:#a6e22e">c</span>(x, x), <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>), gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, lty <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>))
  <span style="color:#a6e22e">grid.text</span>(<span style="color:#e6db74">&#34;Vaccine introduced&#34;</span>, x, <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;npc&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">5</span>, <span style="color:#e6db74">&#34;mm&#34;</span>))
})
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/KJWiacwXbolZgtY.png" alt="ComplexHeatmap-8.2.png"></p>
<h3 id="83-visualize-cell-heterogeneity-from-single-cell-rnaseq">8.3 Visualize Cell Heterogeneity from Single Cell RNASeq</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">rm</span>(list <span style="color:#f92672">=</span> <span style="color:#a6e22e">ls</span>())
<span style="color:#a6e22e">library</span>(ComplexHeatmap)

expr <span style="color:#f92672">=</span> <span style="color:#a6e22e">read.table</span>(<span style="color:#e6db74">&#34;mouse_scRNAseq_corrected.txt&#34;</span>, sep <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;\t&#34;</span>, header <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>,row.names <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
expr <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>(expr)

expr <span style="color:#f92672">=</span> expr<span style="color:#a6e22e">[apply</span>(expr, <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">function</span>(x) <span style="color:#a6e22e">sum</span>(x <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>)<span style="color:#f92672">/</span><span style="color:#a6e22e">length</span>(x) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.5</span>), , drop <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>]

get_correlated_variable_genes <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(mat, n <span style="color:#f92672">=</span> <span style="color:#a6e22e">nrow</span>(mat), cor_cutoff <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, n_cutoff <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) {
  ind <span style="color:#f92672">=</span> <span style="color:#a6e22e">order</span>(<span style="color:#a6e22e">apply</span>(mat, <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">function</span>(x) {
    q <span style="color:#f92672">=</span> <span style="color:#a6e22e">quantile</span>(x, <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">0.9</span>))
    x <span style="color:#f92672">=</span> x[x <span style="color:#f92672">&lt;</span> q[1] <span style="color:#f92672">&amp;</span> x <span style="color:#f92672">&gt;</span> q[2]]
    <span style="color:#a6e22e">var</span>(x)<span style="color:#f92672">/</span><span style="color:#a6e22e">mean</span>(x)
  }), decreasing <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)[1<span style="color:#f92672">:</span>n]
  mat2 <span style="color:#f92672">=</span> mat[ind, , drop <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>]
  dt <span style="color:#f92672">=</span> <span style="color:#a6e22e">cor</span>(<span style="color:#a6e22e">t</span>(mat2), method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;spearman&#34;</span>)
  <span style="color:#a6e22e">diag</span>(dt) <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
  dt<span style="color:#a6e22e">[abs</span>(dt) <span style="color:#f92672">&lt;</span> cor_cutoff] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
  dt[dt <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">-1</span>
  dt[dt <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
  
  i <span style="color:#f92672">=</span> <span style="color:#a6e22e">colSums</span>(<span style="color:#a6e22e">abs</span>(dt)) <span style="color:#f92672">&gt;</span> n_cutoff
  
  mat3 <span style="color:#f92672">=</span> mat2[i, ,drop <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>]
  <span style="color:#a6e22e">return</span>(mat3)
}

mat <span style="color:#f92672">=</span> <span style="color:#a6e22e">get_correlated_variable_genes</span>(expr, cor_cutoff <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>, n_cutoff <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>)
mat2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>(<span style="color:#a6e22e">apply</span>(mat, <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">function</span>(x) {
  q10 <span style="color:#f92672">=</span> <span style="color:#a6e22e">quantile</span>(x, <span style="color:#ae81ff">0.1</span>)
  q90 <span style="color:#f92672">=</span> <span style="color:#a6e22e">quantile</span>(x, <span style="color:#ae81ff">0.9</span>)
  x[x <span style="color:#f92672">&lt;</span> q10] <span style="color:#f92672">=</span> q10
  x[x <span style="color:#f92672">&gt;</span> q90] <span style="color:#f92672">=</span> q90
  <span style="color:#a6e22e">scale</span>(x)
}))
<span style="color:#a6e22e">colnames</span>(mat2) <span style="color:#f92672">=</span> <span style="color:#a6e22e">colnames</span>(mat)

cc <span style="color:#f92672">=</span> <span style="color:#a6e22e">readRDS</span>(<span style="color:#e6db74">&#34;mouse_cell_cycle_gene.rds&#34;</span>)
ccl <span style="color:#f92672">=</span> <span style="color:#a6e22e">rownames</span>(mat) <span style="color:#f92672">%in%</span> cc
cc_gene <span style="color:#f92672">=</span> <span style="color:#a6e22e">rownames</span>(mat)[ccl]

rp <span style="color:#f92672">=</span> <span style="color:#a6e22e">readRDS</span>(<span style="color:#e6db74">&#34;mouse_ribonucleoprotein.rds&#34;</span>)
rpl <span style="color:#f92672">=</span> <span style="color:#a6e22e">rownames</span>(mat) <span style="color:#f92672">%in%</span> rp

base_mean <span style="color:#f92672">=</span> <span style="color:#a6e22e">rowMeans</span>(mat)

<span style="color:#a6e22e">library</span>(GetoptLong)
ht_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat2, col <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-1.5</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1.5</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;blue&#34;</span>, <span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>)), 
                  name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;scaled_expr&#34;</span>, column_title <span style="color:#f92672">=</span> <span style="color:#a6e22e">qq</span>(<span style="color:#e6db74">&#34;relative expression for @{nrow(mat)} genes&#34;</span>),
                  show_column_names <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">8</span>, <span style="color:#e6db74">&#34;cm&#34;</span>),
                  heatmap_legend_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Scaled expr&#34;</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">Heatmap</span>(base_mean, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;base_expr&#34;</span>, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">5</span>, <span style="color:#e6db74">&#34;mm&#34;</span>),
          heatmap_legend_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Base expr&#34;</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">Heatmap</span>(rpl <span style="color:#f92672">+</span> <span style="color:#ae81ff">0</span>, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ribonucleoprotein&#34;</span>, col <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;purple&#34;</span>), 
          show_heatmap_legend <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">5</span>, <span style="color:#e6db74">&#34;mm&#34;</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">Heatmap</span>(ccl <span style="color:#f92672">+</span> <span style="color:#ae81ff">0</span>, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cell_cycle&#34;</span>, col <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>), 
          show_heatmap_legend <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">5</span>, <span style="color:#e6db74">&#34;mm&#34;</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">rowAnnotation</span>(link <span style="color:#f92672">=</span> <span style="color:#a6e22e">anno_mark</span>(at <span style="color:#f92672">=</span> <span style="color:#a6e22e">which</span>(ccl <span style="color:#f92672">&amp;</span> base_mean <span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">quantile</span>(base_mean, <span style="color:#ae81ff">0.25</span>)), 
                                 labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">rownames</span>(mat)[ccl <span style="color:#f92672">&amp;</span> base_mean <span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">quantile</span>(base_mean, <span style="color:#ae81ff">0.25</span>)], 
                                 labels_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>), padding <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;mm&#34;</span>))) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">Heatmap</span>(<span style="color:#a6e22e">cor</span>(<span style="color:#a6e22e">t</span>(mat2)), name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cor&#34;</span>, 
          col <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>)), 
          show_row_names <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, show_column_names <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, row_dend_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;right&#34;</span>, 
          show_column_dend <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;pairwise correlation between genes&#34;</span>,
          heatmap_legend_param <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Correlation&#34;</span>))
ht_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">draw</span>(ht_list, main_heatmap <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cor&#34;</span>)
<span style="color:#a6e22e">decorate_column_dend</span>(<span style="color:#e6db74">&#34;scaled_expr&#34;</span>, {
  tree <span style="color:#f92672">=</span> <span style="color:#a6e22e">column_dend</span>(ht_list)<span style="color:#f92672">$</span>scaled_expr
  ind <span style="color:#f92672">=</span> <span style="color:#a6e22e">cutree</span>(<span style="color:#a6e22e">as.hclust</span>(tree), k <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)<span style="color:#a6e22e">[order.dendrogram</span>(tree)]
  
  first_index <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(l) <span style="color:#a6e22e">which</span>(l)[1]
  last_index <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(l) { x <span style="color:#f92672">=</span> <span style="color:#a6e22e">which</span>(l); x<span style="color:#a6e22e">[length</span>(x)] }
  x1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#a6e22e">first_index</span>(ind <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>), <span style="color:#a6e22e">first_index</span>(ind <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>)) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>
  x2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#a6e22e">last_index</span>(ind <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>), <span style="color:#a6e22e">last_index</span>(ind <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>))
  <span style="color:#a6e22e">grid.rect</span>(x <span style="color:#f92672">=</span> x1<span style="color:#f92672">/</span><span style="color:#a6e22e">length</span>(ind), width <span style="color:#f92672">=</span> (x2 <span style="color:#f92672">-</span> x1)<span style="color:#f92672">/</span><span style="color:#a6e22e">length</span>(ind), just <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>,
            default.units <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;npc&#34;</span>, gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;#FF000040&#34;</span>, <span style="color:#e6db74">&#34;#00FF0040&#34;</span>), col <span style="color:#f92672">=</span> <span style="color:#66d9ef">NA</span>))
})
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/jabkLgmd2zhE7fN.png" alt="ComplexHeatmap-8.3.png"></p>
<h3 id="84-correlations-between-methylation-expression-and-other-genomic-features">8.4 Correlations between methylation, expression and other genomic features</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R"><span style="color:#a6e22e">rm</span>(list <span style="color:#f92672">=</span> <span style="color:#a6e22e">ls</span>())
<span style="color:#a6e22e">library</span>(ComplexHeatmap)

res_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">readRDS</span>(<span style="color:#e6db74">&#34;meth.rds&#34;</span>)
type <span style="color:#f92672">=</span> res_list<span style="color:#f92672">$</span>type
mat_meth <span style="color:#f92672">=</span> res_list<span style="color:#f92672">$</span>mat_meth
mat_expr <span style="color:#f92672">=</span> res_list<span style="color:#f92672">$</span>mat_expr
direction <span style="color:#f92672">=</span> res_list<span style="color:#f92672">$</span>direction
cor_pvalue <span style="color:#f92672">=</span> res_list<span style="color:#f92672">$</span>cor_pvalue
gene_type <span style="color:#f92672">=</span> res_list<span style="color:#f92672">$</span>gene_type
anno_gene <span style="color:#f92672">=</span> res_list<span style="color:#f92672">$</span>anno_gene
dist <span style="color:#f92672">=</span> res_list<span style="color:#f92672">$</span>dist
anno_enhancer <span style="color:#f92672">=</span> res_list<span style="color:#f92672">$</span>anno_enhancer


column_tree <span style="color:#f92672">=</span> <span style="color:#a6e22e">hclust</span>(<span style="color:#a6e22e">dist</span>(<span style="color:#a6e22e">t</span>(mat_meth)))
column_order <span style="color:#f92672">=</span> column_tree<span style="color:#f92672">$</span>order

<span style="color:#a6e22e">library</span>(RColorBrewer)
meth_col_fun <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">1</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;blue&#34;</span>, <span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>))
direction_col <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;hyper&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>, <span style="color:#e6db74">&#34;hypo&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blue&#34;</span>)
expr_col_fun <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-2</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;green&#34;</span>, <span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>))
pvalue_col_fun <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;red&#34;</span>))
gene_type_col <span style="color:#f92672">=</span> <span style="color:#a6e22e">structure</span>(<span style="color:#a6e22e">brewer.pal</span>(<span style="color:#a6e22e">length</span>(<span style="color:#a6e22e">unique</span>(gene_type)), <span style="color:#e6db74">&#34;Set3&#34;</span>), 
                          names <span style="color:#f92672">=</span> <span style="color:#a6e22e">unique</span>(gene_type))
anno_gene_col <span style="color:#f92672">=</span> <span style="color:#a6e22e">structure</span>(<span style="color:#a6e22e">brewer.pal</span>(<span style="color:#a6e22e">length</span>(<span style="color:#a6e22e">unique</span>(anno_gene)), <span style="color:#e6db74">&#34;Set1&#34;</span>), 
                          names <span style="color:#f92672">=</span> <span style="color:#a6e22e">unique</span>(anno_gene))
dist_col_fun <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">10000</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;black&#34;</span>, <span style="color:#e6db74">&#34;white&#34;</span>))
enhancer_col_fun <span style="color:#f92672">=</span> circlize<span style="color:#f92672">::</span><span style="color:#a6e22e">colorRamp2</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>), <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;white&#34;</span>, <span style="color:#e6db74">&#34;orange&#34;</span>))


<span style="color:#a6e22e">ht_opt</span>(
  legend_title_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>, fontface <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bold&#34;</span>), 
  legend_labels_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>), 
  heatmap_column_names_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>),
  heatmap_column_title_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>),
  heatmap_row_title_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>)
)

ha <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(type <span style="color:#f92672">=</span> type, 
                       col <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(type <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;Tumor&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;pink&#34;</span>, <span style="color:#e6db74">&#34;Control&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;royalblue&#34;</span>)),
                       annotation_name_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;left&#34;</span>)
ha2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">HeatmapAnnotation</span>(type <span style="color:#f92672">=</span> type, 
                        col <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(type <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;Tumor&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;pink&#34;</span>, <span style="color:#e6db74">&#34;Control&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;royalblue&#34;</span>)), 
                        show_legend <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)

ht_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(mat_meth, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;methylation&#34;</span>, col <span style="color:#f92672">=</span> meth_col_fun,
                  column_order<span style="color:#f92672">=</span> column_order,
                  top_annotation <span style="color:#f92672">=</span> ha, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Methylation&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">Heatmap</span>(direction, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;direction&#34;</span>, col <span style="color:#f92672">=</span> direction_col) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">Heatmap</span>(mat_expr[, column_tree<span style="color:#f92672">$</span>order], name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;expression&#34;</span>, 
          col <span style="color:#f92672">=</span> expr_col_fun, 
          column_order <span style="color:#f92672">=</span> column_order, 
          top_annotation <span style="color:#f92672">=</span> ha2, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Expression&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">Heatmap</span>(cor_pvalue, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;-log10(cor_p)&#34;</span>, col <span style="color:#f92672">=</span> pvalue_col_fun) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">Heatmap</span>(gene_type, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gene type&#34;</span>, col <span style="color:#f92672">=</span> gene_type_col) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">Heatmap</span>(anno_gene, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;anno_gene&#34;</span>, col <span style="color:#f92672">=</span> anno_gene_col) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">Heatmap</span>(dist, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dist_tss&#34;</span>, col <span style="color:#f92672">=</span> dist_col_fun) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">Heatmap</span>(anno_enhancer, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;anno_enhancer&#34;</span>, col <span style="color:#f92672">=</span> enhancer_col_fun, 
          cluster_columns <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Enhancer&#34;</span>)

<span style="color:#a6e22e">draw</span>(ht_list, row_km <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, row_split <span style="color:#f92672">=</span> direction,
     column_title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Comprehensive correspondence between methylation, expression and other genomic features&#34;</span>, 
     column_title_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>, fontface <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bold&#34;</span>), 
     merge_legends <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, heatmap_legend_side <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bottom&#34;</span>)

<span style="color:#a6e22e">ht_opt</span>(RESET <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/ua8NToBpVCrQc17.png" alt="ComplexHeatmap-8.4.png"></p>
<h3 id="85-add-multiple-boxplots-for-single-row">8.5 Add multiple boxplots for single row</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">m1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">sort</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>)), <span style="color:#ae81ff">10</span>, byrow <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
m2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">sort</span>(<span style="color:#a6e22e">rnorm</span>(<span style="color:#ae81ff">100</span>), decreasing <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>), <span style="color:#ae81ff">10</span>, byrow <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
nr <span style="color:#f92672">=</span> <span style="color:#a6e22e">nrow</span>(m1)

ht_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">Heatmap</span>(m1, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;m1&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">Heatmap</span>(m2, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;m2&#34;</span>)

rg <span style="color:#f92672">=</span> <span style="color:#a6e22e">range</span>(<span style="color:#a6e22e">c</span>(m1, m2))
rg[1] <span style="color:#f92672">=</span> rg[1] <span style="color:#f92672">-</span> (rg[2] <span style="color:#f92672">-</span> rg[1])<span style="color:#f92672">*</span> <span style="color:#ae81ff">0.02</span>
rg[2] <span style="color:#f92672">=</span> rg[2] <span style="color:#f92672">+</span> (rg[2] <span style="color:#f92672">-</span> rg[1])<span style="color:#f92672">*</span> <span style="color:#ae81ff">0.02</span>
anno_multiple_boxplot <span style="color:#f92672">=</span> <span style="color:#a6e22e">function</span>(index) {
  <span style="color:#a6e22e">pushViewport</span>(<span style="color:#a6e22e">viewport</span>(xscale <span style="color:#f92672">=</span> rg, yscale <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.5</span>, nr <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.5</span>)))
  <span style="color:#a6e22e">for</span>(i in <span style="color:#a6e22e">seq_along</span>(index)) {
    <span style="color:#a6e22e">grid.rect</span>(y <span style="color:#f92672">=</span> nr<span style="color:#f92672">-</span>i<span style="color:#ae81ff">+1</span>, height <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, default.units <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;native&#34;</span>)
    <span style="color:#a6e22e">grid.boxplot</span>(m1[ index[i], ], pos <span style="color:#f92672">=</span> nr<span style="color:#f92672">-</span>i<span style="color:#ae81ff">+1</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.2</span>, box_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>, 
                 gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>), direction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;horizontal&#34;</span>)
    <span style="color:#a6e22e">grid.boxplot</span>(m2[ index[i], ], pos <span style="color:#f92672">=</span> nr<span style="color:#f92672">-</span>i<span style="color:#ae81ff">+1</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">0.2</span>, box_width <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>, 
                 gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;green&#34;</span>), direction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;horizontal&#34;</span>)
  }
  <span style="color:#a6e22e">grid.xaxis</span>()
  <span style="color:#a6e22e">popViewport</span>()
}

ht_list <span style="color:#f92672">=</span> ht_list <span style="color:#f92672">+</span> <span style="color:#a6e22e">rowAnnotation</span>(boxplot <span style="color:#f92672">=</span> anno_multiple_boxplot, width <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;cm&#34;</span>), 
                                  show_annotation_name <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
lgd <span style="color:#f92672">=</span> <span style="color:#a6e22e">Legend</span>(labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;m1&#34;</span>, <span style="color:#e6db74">&#34;m2&#34;</span>), title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;boxplots&#34;</span>,
             legend_gp <span style="color:#f92672">=</span> <span style="color:#a6e22e">gpar</span>(fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;red&#34;</span>, <span style="color:#e6db74">&#34;green&#34;</span>)))
<span style="color:#a6e22e">draw</span>(ht_list, padding <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>), <span style="color:#e6db74">&#34;mm&#34;</span>), heatmap_legend_list <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(lgd))
</code></pre></div><p><img src="https://i.loli.net/2020/05/13/Cj1uTaDZBlFGS2X.png" alt="ComplexHeatmap-8.5.png"></p>
<hr>
<p><strong>参考资料：</strong><br>
<a href="https://jokergoo.github.io/ComplexHeatmap-reference/book/">1.ComplexHeatmap Complete Reference</a><br>
<a href="https://www.jianshu.com/p/df5cb1ecfe59">2.【r&lt;-包】ComplexHeatmap（1）：介绍</a><br>
<a href="https://www.jianshu.com/p/aaf93597f484">3.【r&lt;-包】ComplexHeatmap（2）：创建一个简单的热图</a><br>
<a href="https://www.jianshu.com/p/c9643a52d75c">4.【r&lt;-包】ComplexHeatmap（3）：创建热图列表</a><br>
<a href="https://www.jianshu.com/p/8ed637722b0b">5.【r&lt;-包】ComplexHeatmap（4）：热图注释</a><br>
<a href="https://www.jianshu.com/p/42adf881e587">6.【r&lt;-包】ComplexHeatmap（5）：热图和注释图例</a><br>
<a href="https://www.jianshu.com/p/d8b8f7acf47c">7.使用ComplexHeatmap包绘制热图</a><br>
<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTEwODk0Ng==&amp;mid=2247490619&amp;idx=1&amp;sn=97db7f08ff2d5af680645c377b2bfa67&amp;chksm=fa46d906cd315010074c8b00c9f3d54d6e06a0ddd0dfa759bcc5a26a93e1335ecaf107da0891&amp;scene=0&amp;xtrack=1&amp;key=0bede9ac882f25ace7dbcddc3b3709ef26853b4cf56e87b15f2b11c410aac6f1d7b8781bf113ac6f6638f9d5b525997140fbda25a7b9fa5699ac0696d18c0cb26d9a55810cdac103420bfe4a42617e56&amp;ascene=14&amp;uin=NjkwMTYwNDgw&amp;devicetype=Windows+10+x64&amp;version=62090070&amp;lang=zh_CN&amp;exportkey=AZx%2FonQmjPP13qFfGOXsmwI%3D&amp;pass_ticket=w6EsrU%2BDz3gNH7uOufu8Jr6DcyxUmFecVk1JRMHleXwSr75IGlBVrRMIDEeEtS4l">8.ComplexHeatmap包更新支持pheatmap转换</a></p>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://pengpengyang94.github.io/tags/complexheatmap/">ComplexHeatmap</a>

  <a class="tag tag--primary tag--small" href="https://pengpengyang94.github.io/tags/heatmap/">Heatmap</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://pengpengyang94.github.io/2020/05/eoffice%E5%91%8A%E8%AF%89%E4%BD%A0%E4%B8%8D%E4%BC%9A%E7%94%A8ai%E5%92%8Cps%E6%B2%A1%E5%85%B3%E7%B3%BB/" data-tooltip="eoffice告诉你不会用AI和PS没关系">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://pengpengyang94.github.io/2020/05/linux%E4%B8%8A%E7%9A%84%E7%A5%9E%E5%99%A8anaconda/" data-tooltip="Linux上的神器Anaconda">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://pengpengyang94.github.io/2020/05/complexheatmap%E4%B8%AD%E6%96%87%E7%89%88%E8%AF%B4%E6%98%8E/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://pengpengyang94.github.io/2020/05/complexheatmap%E4%B8%AD%E6%96%87%E7%89%88%E8%AF%B4%E6%98%8E/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://pengpengyang94.github.io/2020/05/complexheatmap%E4%B8%AD%E6%96%87%E7%89%88%E8%AF%B4%E6%98%8E/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2024 Ezio. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://pengpengyang94.github.io/2020/05/eoffice%E5%91%8A%E8%AF%89%E4%BD%A0%E4%B8%8D%E4%BC%9A%E7%94%A8ai%E5%92%8Cps%E6%B2%A1%E5%85%B3%E7%B3%BB/" data-tooltip="eoffice告诉你不会用AI和PS没关系">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://pengpengyang94.github.io/2020/05/linux%E4%B8%8A%E7%9A%84%E7%A5%9E%E5%99%A8anaconda/" data-tooltip="Linux上的神器Anaconda">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://pengpengyang94.github.io/2020/05/complexheatmap%E4%B8%AD%E6%96%87%E7%89%88%E8%AF%B4%E6%98%8E/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://pengpengyang94.github.io/2020/05/complexheatmap%E4%B8%AD%E6%96%87%E7%89%88%E8%AF%B4%E6%98%8E/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://pengpengyang94.github.io/2020/05/complexheatmap%E4%B8%AD%E6%96%87%E7%89%88%E8%AF%B4%E6%98%8E/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="5">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fpengpengyang94.github.io%2F2020%2F05%2Fcomplexheatmap%25E4%25B8%25AD%25E6%2596%2587%25E7%2589%2588%25E8%25AF%25B4%25E6%2598%258E%2F">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fpengpengyang94.github.io%2F2020%2F05%2Fcomplexheatmap%25E4%25B8%25AD%25E6%2596%2587%25E7%2589%2588%25E8%25AF%25B4%25E6%2598%258E%2F">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https%3A%2F%2Fpengpengyang94.github.io%2F2020%2F05%2Fcomplexheatmap%25E4%25B8%25AD%25E6%2596%2587%25E7%2589%2588%25E8%25AF%25B4%25E6%2598%258E%2F">
          <i class="fa fa-google-plus"></i><span>Share on Google&#43;</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://i.loli.net/2020/04/15/xFaPfkeSHjc3sg4.jpg" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Ezio</h4>
    
      <div id="about-card-bio">学习、记录、变强，最后 <strong>变秃</strong></div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        生物信息学
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        中国 云南 昆明
      </div>
    
  </div>
</div>

    

    
  
    
      <div id="cover" style="background-image:url('https://pengpengyang94.github.io/images/cover.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://pengpengyang94.github.io/js/script-pcw6v3xilnxydl1vddzazdverrnn9ctynvnxgwho987mfyqkuylcb1nlt.min.js"></script>


<script lang="javascript">
window.onload = updateMinWidth;
window.onresize = updateMinWidth;
document.getElementById("sidebar").addEventListener("transitionend", updateMinWidth);
function updateMinWidth() {
  var sidebar = document.getElementById("sidebar");
  var main = document.getElementById("main");
  main.style.minWidth = "";
  var w1 = getComputedStyle(main).getPropertyValue("min-width");
  var w2 = getComputedStyle(sidebar).getPropertyValue("width");
  var w3 = getComputedStyle(sidebar).getPropertyValue("left");
  main.style.minWidth = `calc(${w1} - ${w2} - ${w3})`;
}
</script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'https:\/\/pengpengyang94.github.io\/2020\/05\/complexheatmap%E4%B8%AD%E6%96%87%E7%89%88%E8%AF%B4%E6%98%8E\/';
          
            this.page.identifier = '\/2020\/05\/complexheatmap%E4%B8%AD%E6%96%87%E7%89%88%E8%AF%B4%E6%98%8E\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'hugo-tranquilpeak-theme';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  




    
  </body>
</html>

